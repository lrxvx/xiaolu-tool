<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ¨æ¼«å›¾ç‰‡è½¬é“…ç¬”çº¿ç¨¿å·¥å…· - å°è·¯å·¥å…·ç®±</title>
    <meta name="description" content="å…è´¹åœ¨çº¿åŠ¨æ¼«å›¾ç‰‡è½¬é“…ç¬”çº¿ç¨¿å·¥å…·ï¼Œæ”¯æŒJPGã€PNGç­‰æ ¼å¼ï¼Œä¸€é”®ç”Ÿæˆäººç‰©è½®å»“çº¿ç¨¿ï¼Œé€‚åˆå„¿ç«¥æ¶‚è‰²ä½¿ç”¨ï¼Œç®€æ´æ˜“ç”¨çš„ç•Œé¢è®¾è®¡">
    <meta name="keywords" content="åŠ¨æ¼«è½¬çº¿ç¨¿,å›¾ç‰‡è½¬é“…ç¬”ç”»,çº¿ç¨¿ç”Ÿæˆå™¨,æ¶‚è‰²çº¿ç¨¿,åŠ¨æ¼«çº¿ç¨¿,å…è´¹çº¿ç¨¿å·¥å…·,åœ¨çº¿å›¾ç‰‡å¤„ç†">
    <meta name="author" content="å°è·¯å·¥å…·ç®±">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://tools.xiaolu.page/tools/anime-to-sketch.html">
    <meta property="og:title" content="åŠ¨æ¼«å›¾ç‰‡è½¬é“…ç¬”çº¿ç¨¿å·¥å…· - å°è·¯å·¥å…·ç®±">
    <meta property="og:description" content="å…è´¹åœ¨çº¿åŠ¨æ¼«å›¾ç‰‡è½¬é“…ç¬”çº¿ç¨¿å·¥å…·ï¼Œæ”¯æŒJPGã€PNGç­‰æ ¼å¼ï¼Œä¸€é”®ç”Ÿæˆäººç‰©è½®å»“çº¿ç¨¿ï¼Œé€‚åˆå„¿ç«¥æ¶‚è‰²ä½¿ç”¨">
    <meta property="og:image" content="https://tools.xiaolu.page/images/anime-to-sketch-preview.jpg">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://tools.xiaolu.page/tools/anime-to-sketch.html">
    <meta property="twitter:title" content="åŠ¨æ¼«å›¾ç‰‡è½¬é“…ç¬”çº¿ç¨¿å·¥å…· - å°è·¯å·¥å…·ç®±">
    <meta property="twitter:description" content="å…è´¹åœ¨çº¿åŠ¨æ¼«å›¾ç‰‡è½¬é“…ç¬”çº¿ç¨¿å·¥å…·ï¼Œæ”¯æŒJPGã€PNGç­‰æ ¼å¼ï¼Œä¸€é”®ç”Ÿæˆäººç‰©è½®å»“çº¿ç¨¿ï¼Œé€‚åˆå„¿ç«¥æ¶‚è‰²ä½¿ç”¨">
    <meta property="twitter:image" content="https://tools.xiaolu.page/images/anime-to-sketch-preview.jpg">
    
    <!-- ç»“æ„åŒ–æ•°æ® -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "åŠ¨æ¼«å›¾ç‰‡è½¬é“…ç¬”çº¿ç¨¿å·¥å…·",
        "description": "å…è´¹åœ¨çº¿åŠ¨æ¼«å›¾ç‰‡è½¬é“…ç¬”çº¿ç¨¿å·¥å…·ï¼Œæ”¯æŒJPGã€PNGç­‰æ ¼å¼ï¼Œä¸€é”®ç”Ÿæˆäººç‰©è½®å»“çº¿ç¨¿ï¼Œé€‚åˆå„¿ç«¥æ¶‚è‰²ä½¿ç”¨",
        "url": "https://tools.xiaolu.page/tools/anime-to-sketch.html",
        "applicationCategory": "MultimediaApplication",
        "operatingSystem": "Any",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "CNY"
        }
    }
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }
        
        /* å¯¼èˆªæ æ ·å¼ç”±ç»„ä»¶æä¾› */
        
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* å¯¼èˆªæ æ ·å¼ç”±ç»„ä»¶æä¾› */
        
        /* å¯¼èˆªæ æ ·å¼ç”±ç»„ä»¶æä¾› */
        
        /* å¯¼èˆªæ æ ·å¼ç”±ç»„ä»¶æä¾› */
        
        /* å¯¼èˆªæ æ ·å¼ç”±ç»„ä»¶æä¾› */
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        
            flex: 1;}
        
        .tool-/* å¯¼èˆªæ æ ·å¼ç”±ç»„ä»¶æä¾› */
        
        .tool-header h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .tool-header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .main-content {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin-bottom: 3rem;
        
            flex: 1;}
        
        .upload-area {
            border: 3px dashed #007AFF;
            border-radius: 15px;
            padding: 3rem;
            text-align: center;
            background: #f8f9ff;
            transition: all 0.3s ease;
            margin-bottom: 2rem;
            cursor: pointer;
        }
        
        .upload-area:hover {
            border-color: #0056b3;
            background: #f0f4ff;
        }
        
        .upload-area.dragover {
            border-color: #28a745;
            background: #f0fff4;
        }
        
        .upload-icon {
            font-size: 4rem;
            color: #007AFF;
            margin-bottom: 1rem;
        }
        
        .upload-text {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 1rem;
        }
        
        .upload-hint {
            font-size: 0.9rem;
            color: #999;
        }
        
        .file-input {
            display: none;
        }
        
        .preview-container {
            display: none;
            margin-top: 2rem;
        }
        
        .preview-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .preview-item {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
        }
        
        .preview-item h3 {
            margin-bottom: 1rem;
            color: #333;
            font-size: 1.1rem;
        }
        
        .preview-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 2rem;
        }
        
        .btn {
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn-primary {
            background: #007AFF;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #545b62;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #1e7e34;
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .progress-container {
            display: none;
            margin: 2rem 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #007AFF, #0056b3);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .progress-text {
            text-align: center;
            margin-top: 0.5rem;
            color: #666;
            font-size: 0.9rem;
        }
        
        .settings-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .settings-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #333;
        }
        
        .setting-group {
            margin-bottom: 1rem;
        }
        
        .setting-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #555;
        }
        
        .setting-input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .info-section {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .info-section h2 {
            color: #333;
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
        }
        
        .info-section h3 {
            color: #007AFF;
            margin: 1.5rem 0 1rem 0;
            font-size: 1.3rem;
        }
        
        .info-section p, .info-section li {
            color: #666;
            margin-bottom: 0.8rem;
        }
        
        .info-section ul {
            padding-left: 1.5rem;
        }
        
        .footer {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 2rem 0;
            text-align: center;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .footer-links a {
            color: #666;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .footer-links a:hover {
            color: #007AFF;
        }
        
        .footer-text {
            color: #999;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            /* å¯¼èˆªæ æ ·å¼ç”±ç»„ä»¶æä¾› */
            
            .container {
                padding: 1rem;
            
            flex: 1;}
            
            .main-content {
                padding: 2rem 1.5rem;
            
            flex: 1;}
            
            .tool-header h1 {
                font-size: 2rem;
            }
            
            .preview-grid {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
            }
            
            .footer-links {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>

    <!-- å¯¼èˆªæ å’Œé¡µè„šç»„ä»¶ -->
    <script src="../components/navbar.js"></script>
    <script src="../components/footer.js"></script>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    
    <!-- å¯¼èˆªæ å°†é€šè¿‡JavaScriptç»„ä»¶è‡ªåŠ¨ç”Ÿæˆ -->

    <div class="container">
        <!-- å·¥å…·æ ‡é¢˜ -->
        <div class="tool-header">
            <h1>ğŸ¨ åŠ¨æ¼«å›¾ç‰‡è½¬é“…ç¬”çº¿ç¨¿</h1>
            <p>å°†åŠ¨æ¼«å›¾ç‰‡è½¬æ¢ä¸ºé“…ç¬”çº¿ç¨¿ï¼Œé€‚åˆå„¿ç«¥æ¶‚è‰²ä½¿ç”¨</p>
        </div>

        <!-- ä¸»è¦å†…å®¹ -->
        <div class="main-content">
            <!-- ä¸Šä¼ åŒºåŸŸ -->
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">ğŸ“¸</div>
                <div class="upload-text">æ‹–æ‹½åŠ¨æ¼«å›¾ç‰‡åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</div>
                <div class="upload-hint">æ”¯æŒ JPGã€PNGã€GIFã€BMPã€WEBP ç­‰æ ¼å¼</div>
                <input type="file" id="fileInput" class="file-input" accept="image/*">
            </div>

            <!-- è®¾ç½®é¢æ¿ -->
            <div class="settings-panel">
                <div class="settings-title">çº¿ç¨¿è®¾ç½®</div>
                <div class="setting-group">
                    <label class="setting-label">è¾¹ç¼˜æ£€æµ‹å¼ºåº¦</label>
                    <input type="range" id="edgeStrength" class="setting-input" min="50" max="200" value="100">
                </div>
                <div class="setting-group">
                    <label class="setting-label">çº¿æ¡ç²—ç»†</label>
                    <input type="range" id="lineThickness" class="setting-input" min="1" max="5" value="2">
                </div>
                <div class="setting-group">
                    <label class="setting-label">å¯¹æ¯”åº¦</label>
                    <input type="range" id="contrast" class="setting-input" min="50" max="150" value="100">
                </div>
            </div>

            <!-- é¢„è§ˆåŒºåŸŸ -->
            <div class="preview-container" id="previewContainer">
                <div class="preview-grid">
                    <div class="preview-item">
                        <h3>åŸå§‹å›¾ç‰‡</h3>
                        <img id="originalImage" class="preview-image" alt="åŸå§‹å›¾ç‰‡">
                    </div>
                    <div class="preview-item">
                        <h3>é“…ç¬”çº¿ç¨¿</h3>
                        <canvas id="sketchCanvas" class="preview-image"></canvas>
                    </div>
                </div>

                <!-- æ§åˆ¶æŒ‰é’® -->
                <div class="controls">
                    <button id="generateBtn" class="btn btn-primary">ç”Ÿæˆçº¿ç¨¿</button>
                    <button id="downloadBtn" class="btn btn-success" disabled>ä¸‹è½½çº¿ç¨¿</button>
                    <button id="resetBtn" class="btn btn-secondary">é‡æ–°é€‰æ‹©</button>
                </div>
            </div>

            <!-- è¿›åº¦æ¡ -->
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">å¤„ç†ä¸­...</div>
            </div>
        </div>

        <!-- ä½¿ç”¨è¯´æ˜ -->
        <div class="info-section">
            <h2>ğŸ“– ä½¿ç”¨è¯´æ˜</h2>
            <h3>å¦‚ä½•ä½¿ç”¨</h3>
            <ul>
                <li>ç‚¹å‡»ä¸Šä¼ åŒºåŸŸæˆ–æ‹–æ‹½åŠ¨æ¼«å›¾ç‰‡åˆ°æŒ‡å®šåŒºåŸŸ</li>
                <li>æ”¯æŒ JPGã€PNGã€GIFã€BMPã€WEBP ç­‰å¸¸è§å›¾ç‰‡æ ¼å¼</li>
                <li>è°ƒæ•´çº¿ç¨¿è®¾ç½®å‚æ•°ä»¥è·å¾—æœ€ä½³æ•ˆæœ</li>
                <li>ç‚¹å‡»"ç”Ÿæˆçº¿ç¨¿"æŒ‰é’®å¼€å§‹å¤„ç†</li>
                <li>é¢„è§ˆæ•ˆæœæ»¡æ„åï¼Œç‚¹å‡»"ä¸‹è½½çº¿ç¨¿"ä¿å­˜åˆ°æœ¬åœ°</li>
            </ul>
            
            <h3>å‚æ•°è¯´æ˜</h3>
            <ul>
                <li><strong>è¾¹ç¼˜æ£€æµ‹å¼ºåº¦ï¼š</strong>æ§åˆ¶çº¿æ¡çš„æ¸…æ™°åº¦å’Œç»†èŠ‚ç¨‹åº¦</li>
                <li><strong>çº¿æ¡ç²—ç»†ï¼š</strong>è°ƒæ•´ç”Ÿæˆçº¿ç¨¿çš„çº¿æ¡ç²—ç»†</li>
                <li><strong>å¯¹æ¯”åº¦ï¼š</strong>è°ƒæ•´çº¿ç¨¿çš„æ˜æš—å¯¹æ¯”</li>
            </ul>
            
            <h3>æœ€ä½³å®è·µ</h3>
            <ul>
                <li>é€‰æ‹©è½®å»“æ¸…æ™°ã€å¯¹æ¯”åº¦è¾ƒé«˜çš„åŠ¨æ¼«å›¾ç‰‡æ•ˆæœæ›´ä½³</li>
                <li>å»ºè®®å›¾ç‰‡åˆ†è¾¨ç‡åœ¨ 500x500 åˆ° 2000x2000 åƒç´ ä¹‹é—´</li>
                <li>äººç‰©å›¾ç‰‡æ¯”é£æ™¯å›¾ç‰‡æ›´é€‚åˆè½¬æ¢ä¸ºçº¿ç¨¿</li>
                <li>å¯ä»¥å¤šæ¬¡è°ƒæ•´å‚æ•°ç›´åˆ°è·å¾—æ»¡æ„çš„æ•ˆæœ</li>
            </ul>
        </div>

        <!-- å¸¸è§é—®é¢˜ -->
        <div class="info-section">
            <h2>â“ å¸¸è§é—®é¢˜</h2>
            
            <h3>Q: æ”¯æŒå“ªäº›å›¾ç‰‡æ ¼å¼ï¼Ÿ</h3>
            <p>A: æ”¯æŒ JPGã€PNGã€GIFã€BMPã€WEBP ç­‰å¸¸è§å›¾ç‰‡æ ¼å¼ï¼Œæ¨èä½¿ç”¨ PNG æˆ– JPG æ ¼å¼ä»¥è·å¾—æœ€ä½³æ•ˆæœã€‚</p>
            
            <h3>Q: å›¾ç‰‡å¤§å°æœ‰é™åˆ¶å—ï¼Ÿ</h3>
            <p>A: å»ºè®®ä¸Šä¼ çš„å›¾ç‰‡æ–‡ä»¶å¤§å°ä¸è¶…è¿‡ 10MBï¼Œåˆ†è¾¨ç‡åœ¨ 500x500 åˆ° 2000x2000 åƒç´ ä¹‹é—´æ•ˆæœæœ€ä½³ã€‚</p>
            
            <h3>Q: ç”Ÿæˆçš„çº¿ç¨¿ä¸å¤Ÿæ¸…æ™°æ€ä¹ˆåŠï¼Ÿ</h3>
            <p>A: å¯ä»¥å°è¯•è°ƒæ•´"è¾¹ç¼˜æ£€æµ‹å¼ºåº¦"å‚æ•°ï¼Œå¢åŠ æ•°å€¼å¯ä»¥è·å¾—æ›´æ¸…æ™°çš„çº¿æ¡ï¼Œæˆ–è€…é€‰æ‹©å¯¹æ¯”åº¦æ›´é«˜çš„åŸå›¾ã€‚</p>
            
            <h3>Q: å¯ä»¥æ‰¹é‡å¤„ç†å›¾ç‰‡å—ï¼Ÿ</h3>
            <p>A: ç›®å‰ç‰ˆæœ¬æ”¯æŒå•å¼ å›¾ç‰‡å¤„ç†ï¼Œå¦‚éœ€æ‰¹é‡å¤„ç†åŠŸèƒ½ï¼Œè¯·è”ç³»æˆ‘ä»¬åé¦ˆéœ€æ±‚ã€‚</p>
            
            <h3>Q: ç”Ÿæˆçš„çº¿ç¨¿å¯ä»¥å•†ç”¨å—ï¼Ÿ</h3>
            <p>A: å·¥å…·æœ¬èº«å…è´¹ä½¿ç”¨ï¼Œä½†è¯·ç¡®ä¿åŸå›¾ç‰‡çš„ç‰ˆæƒåˆè§„ï¼Œç”Ÿæˆçš„çº¿ç¨¿ç”¨é€”éœ€éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„ã€‚</p>
            
            <h3>Q: å¤„ç†é€Ÿåº¦æ…¢æ€ä¹ˆåŠï¼Ÿ</h3>
            <p>A: å¤„ç†é€Ÿåº¦å–å†³äºå›¾ç‰‡å¤§å°å’Œè®¾å¤‡æ€§èƒ½ï¼Œå»ºè®®ä½¿ç”¨è¾ƒæ–°çš„æµè§ˆå™¨ï¼Œå¹¶ç¡®ä¿ç½‘ç»œè¿æ¥ç¨³å®šã€‚</p>
        </div>
    </div>

    <!-- åº•éƒ¨ -->
    
    <!-- é¡µè„šå°†é€šè¿‡JavaScriptç»„ä»¶è‡ªåŠ¨ç”Ÿæˆ -->

    <script>
        // DOM å…ƒç´ 
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const previewContainer = document.getElementById('previewContainer');
        const originalImage = document.getElementById('originalImage');
        const sketchCanvas = document.getElementById('sketchCanvas');
        const generateBtn = document.getElementById('generateBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const resetBtn = document.getElementById('resetBtn');
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        
        // è®¾ç½®å‚æ•°
        const edgeStrength = document.getElementById('edgeStrength');
        const lineThickness = document.getElementById('lineThickness');
        const contrast = document.getElementById('contrast');
        
        let currentImageFile = null;
        
        // ä¸Šä¼ åŒºåŸŸç‚¹å‡»äº‹ä»¶
        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });
        
        // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
        fileInput.addEventListener('change', handleFileSelect);
        
        // æ‹–æ‹½äº‹ä»¶
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });
        
        // æŒ‰é’®äº‹ä»¶
        generateBtn.addEventListener('click', generateSketch);
        downloadBtn.addEventListener('click', downloadSketch);
        resetBtn.addEventListener('click', resetTool);
        
        // å¤„ç†æ–‡ä»¶é€‰æ‹©
        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                handleFile(file);
            }
        }
        
        // å¤„ç†æ–‡ä»¶
        function handleFile(file) {
            // éªŒè¯æ–‡ä»¶ç±»å‹
            if (!file.type.startsWith('image/')) {
                alert('è¯·é€‰æ‹©æœ‰æ•ˆçš„å›¾ç‰‡æ–‡ä»¶ï¼');
                return;
            }
            
            // éªŒè¯æ–‡ä»¶å¤§å° (10MB)
            if (file.size > 10 * 1024 * 1024) {
                alert('å›¾ç‰‡æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ 10MBï¼');
                return;
            }
            
            currentImageFile = file;
            
            // æ˜¾ç¤ºåŸå›¾é¢„è§ˆ
            const reader = new FileReader();
            reader.onload = (e) => {
                originalImage.src = e.target.result;
                previewContainer.style.display = 'block';
                generateBtn.disabled = false;
                downloadBtn.disabled = true;
            };
            reader.readAsDataURL(file);
        }
        
        // ç”Ÿæˆçº¿ç¨¿
        async function generateSketch() {
            if (!currentImageFile) return;
            
            try {
                showProgress('æ­£åœ¨å¤„ç†å›¾ç‰‡...');
                generateBtn.disabled = true;
                
                // åˆ›å»ºå›¾ç‰‡å¯¹è±¡
                const img = new Image();
                img.onload = () => {
                    processImageToSketch(img);
                };
                img.src = originalImage.src;
                
            } catch (error) {
                console.error('ç”Ÿæˆçº¿ç¨¿å¤±è´¥:', error);
                alert('ç”Ÿæˆçº¿ç¨¿å¤±è´¥ï¼Œè¯·é‡è¯•ï¼');
                hideProgress();
                generateBtn.disabled = false;
            }
        }
        
        // å›¾ç‰‡è½¬çº¿ç¨¿å¤„ç†
        function processImageToSketch(img) {
            const canvas = sketchCanvas;
            const ctx = canvas.getContext('2d');
            
            // è®¾ç½®ç”»å¸ƒå°ºå¯¸
            canvas.width = img.width;
            canvas.height = img.height;
            
            // ç»˜åˆ¶åŸå›¾
            ctx.drawImage(img, 0, 0);
            
            updateProgress(30, 'æ­£åœ¨åˆ†æå›¾åƒ...');
            
            // è·å–å›¾åƒæ•°æ®
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            
            updateProgress(50, 'æ­£åœ¨ç”Ÿæˆçº¿ç¨¿...');
            
            // è½¬æ¢ä¸ºç°åº¦å›¾
            for (let i = 0; i < data.length; i += 4) {
                const gray = data[i] * 0.299 + data[i + 1] * 0.587 + data[i + 2] * 0.114;
                data[i] = gray;
                data[i + 1] = gray;
                data[i + 2] = gray;
            }
            
            updateProgress(70, 'æ­£åœ¨æ£€æµ‹è¾¹ç¼˜...');
            
            // è¾¹ç¼˜æ£€æµ‹ (Sobelç®—å­)
            const edgeData = detectEdges(data, canvas.width, canvas.height);
            
            updateProgress(90, 'æ­£åœ¨ä¼˜åŒ–çº¿æ¡...');
            
            // åº”ç”¨è®¾ç½®å‚æ•°
            const strength = parseInt(edgeStrength.value) / 100;
            const thickness = parseInt(lineThickness.value);
            const contrastValue = parseInt(contrast.value) / 100;
            
            // å¤„ç†è¾¹ç¼˜æ•°æ®
            for (let i = 0; i < edgeData.length; i += 4) {
                let intensity = edgeData[i] * strength * contrastValue;
                intensity = Math.min(255, Math.max(0, intensity));
                
                // åè½¬é¢œè‰² (é»‘çº¿ç™½åº•)
                const value = 255 - intensity;
                edgeData[i] = value;
                edgeData[i + 1] = value;
                edgeData[i + 2] = value;
                edgeData[i + 3] = 255;
            }
            
            // åº”ç”¨çº¿æ¡ç²—ç»†
            if (thickness > 1) {
                applyLineThickness(edgeData, canvas.width, canvas.height, thickness);
            }
            
            // ç»˜åˆ¶ç»“æœ
            const resultImageData = new ImageData(edgeData, canvas.width, canvas.height);
            ctx.putImageData(resultImageData, 0, 0);
            
            updateProgress(100, 'å®Œæˆï¼');
            
            setTimeout(() => {
                hideProgress();
                generateBtn.disabled = false;
                downloadBtn.disabled = false;
            }, 500);
        }
        
        // è¾¹ç¼˜æ£€æµ‹ç®—æ³•
        function detectEdges(data, width, height) {
            const result = new Uint8ClampedArray(data.length);
            
            // Sobelç®—å­
            const sobelX = [-1, 0, 1, -2, 0, 2, -1, 0, 1];
            const sobelY = [-1, -2, -1, 0, 0, 0, 1, 2, 1];
            
            for (let y = 1; y < height - 1; y++) {
                for (let x = 1; x < width - 1; x++) {
                    let gx = 0, gy = 0;
                    
                    for (let ky = -1; ky <= 1; ky++) {
                        for (let kx = -1; kx <= 1; kx++) {
                            const idx = ((y + ky) * width + (x + kx)) * 4;
                            const pixel = data[idx];
                            const kernelIdx = (ky + 1) * 3 + (kx + 1);
                            
                            gx += pixel * sobelX[kernelIdx];
                            gy += pixel * sobelY[kernelIdx];
                        }
                    }
                    
                    const magnitude = Math.sqrt(gx * gx + gy * gy);
                    const idx = (y * width + x) * 4;
                    
                    result[idx] = magnitude;
                    result[idx + 1] = magnitude;
                    result[idx + 2] = magnitude;
                    result[idx + 3] = 255;
                }
            }
            
            return result;
        }
        
        // åº”ç”¨çº¿æ¡ç²—ç»†
        function applyLineThickness(data, width, height, thickness) {
            const temp = new Uint8ClampedArray(data);
            const radius = Math.floor(thickness / 2);
            
            for (let y = radius; y < height - radius; y++) {
                for (let x = radius; x < width - radius; x++) {
                    const idx = (y * width + x) * 4;
                    
                    if (temp[idx] < 128) { // å¦‚æœæ˜¯çº¿æ¡åƒç´ 
                        // åœ¨å‘¨å›´åŒºåŸŸåŠ ç²—
                        for (let dy = -radius; dy <= radius; dy++) {
                            for (let dx = -radius; dx <= radius; dx++) {
                                if (dx * dx + dy * dy <= radius * radius) {
                                    const newIdx = ((y + dy) * width + (x + dx)) * 4;
                                    data[newIdx] = Math.min(data[newIdx], temp[idx]);
                                    data[newIdx + 1] = Math.min(data[newIdx + 1], temp[idx]);
                                    data[newIdx + 2] = Math.min(data[newIdx + 2], temp[idx]);
                                }
                            }
                        }
                    }
                }
            }
        }
        
        // ä¸‹è½½çº¿ç¨¿
        function downloadSketch() {
            const canvas = sketchCanvas;
            const link = document.createElement('a');
            link.download = `sketch_${Date.now()}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        }
        
        // é‡ç½®å·¥å…·
        function resetTool() {
            currentImageFile = null;
            previewContainer.style.display = 'none';
            generateBtn.disabled = true;
            downloadBtn.disabled = true;
            fileInput.value = '';
            hideProgress();
        }
        
        // æ˜¾ç¤ºè¿›åº¦
        function showProgress(text) {
            progressContainer.style.display = 'block';
            progressText.textContent = text;
            progressFill.style.width = '0%';
        }
        
        // æ›´æ–°è¿›åº¦
        function updateProgress(percent, text) {
            progressFill.style.width = percent + '%';
            progressText.textContent = text;
        }
        
        // éšè—è¿›åº¦
        function hideProgress() {
            progressContainer.style.display = 'none';
        }
        
        // å‚æ•°å˜åŒ–æ—¶è‡ªåŠ¨é‡æ–°ç”Ÿæˆï¼ˆé˜²æŠ–ï¼‰
        let debounceTimer;
        [edgeStrength, lineThickness, contrast].forEach(input => {
            input.addEventListener('input', () => {
                if (currentImageFile && !generateBtn.disabled) {
                    clearTimeout(debounceTimer);
                    debounceTimer = setTimeout(() => {
                        generateSketch();
                    }, 500);
                }
            });
        });
    </script>
</body>
</html>