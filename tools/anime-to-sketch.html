<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>动漫图片转铅笔线稿工具 - 小路工具箱</title>
    <meta name="description" content="免费在线动漫图片转铅笔线稿工具，支持JPG、PNG等格式，一键生成人物轮廓线稿，适合儿童涂色使用，简洁易用的界面设计">
    <meta name="keywords" content="动漫转线稿,图片转铅笔画,线稿生成器,涂色线稿,动漫线稿,免费线稿工具,在线图片处理">
    <meta name="author" content="小路工具箱">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://tools.xiaolu.page/tools/anime-to-sketch.html">
    <meta property="og:title" content="动漫图片转铅笔线稿工具 - 小路工具箱">
    <meta property="og:description" content="免费在线动漫图片转铅笔线稿工具，支持JPG、PNG等格式，一键生成人物轮廓线稿，适合儿童涂色使用">
    <meta property="og:image" content="https://tools.xiaolu.page/images/anime-to-sketch-preview.jpg">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://tools.xiaolu.page/tools/anime-to-sketch.html">
    <meta property="twitter:title" content="动漫图片转铅笔线稿工具 - 小路工具箱">
    <meta property="twitter:description" content="免费在线动漫图片转铅笔线稿工具，支持JPG、PNG等格式，一键生成人物轮廓线稿，适合儿童涂色使用">
    <meta property="twitter:image" content="https://tools.xiaolu.page/images/anime-to-sketch-preview.jpg">
    
    <!-- 结构化数据 -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "动漫图片转铅笔线稿工具",
        "description": "免费在线动漫图片转铅笔线稿工具，支持JPG、PNG等格式，一键生成人物轮廓线稿，适合儿童涂色使用",
        "url": "https://tools.xiaolu.page/tools/anime-to-sketch.html",
        "applicationCategory": "MultimediaApplication",
        "operatingSystem": "Any",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "CNY"
        }
    }
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }
        
        /* 导航栏样式由组件提供 */
        
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* 导航栏样式由组件提供 */
        
        /* 导航栏样式由组件提供 */
        
        /* 导航栏样式由组件提供 */
        
        /* 导航栏样式由组件提供 */
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        
            flex: 1;}
        
        .tool-/* 导航栏样式由组件提供 */
        
        .tool-header h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .tool-header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .main-content {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin-bottom: 3rem;
        
            flex: 1;}
        
        .upload-area {
            border: 3px dashed #007AFF;
            border-radius: 15px;
            padding: 3rem;
            text-align: center;
            background: #f8f9ff;
            transition: all 0.3s ease;
            margin-bottom: 2rem;
            cursor: pointer;
        }
        
        .upload-area:hover {
            border-color: #0056b3;
            background: #f0f4ff;
        }
        
        .upload-area.dragover {
            border-color: #28a745;
            background: #f0fff4;
        }
        
        .upload-icon {
            font-size: 4rem;
            color: #007AFF;
            margin-bottom: 1rem;
        }
        
        .upload-text {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 1rem;
        }
        
        .upload-hint {
            font-size: 0.9rem;
            color: #999;
        }
        
        .file-input {
            display: none;
        }
        
        .preview-container {
            display: none;
            margin-top: 2rem;
        }
        
        .preview-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .preview-item {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
        }
        
        .preview-item h3 {
            margin-bottom: 1rem;
            color: #333;
            font-size: 1.1rem;
        }
        
        .preview-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 2rem;
        }
        
        .btn {
            padding: 0.8rem 2rem;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        
        .btn-primary {
            background: #007AFF;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #545b62;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #1e7e34;
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .progress-container {
            display: none;
            margin: 2rem 0;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #007AFF, #0056b3);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .progress-text {
            text-align: center;
            margin-top: 0.5rem;
            color: #666;
            font-size: 0.9rem;
        }
        
        .settings-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .settings-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: #333;
        }
        
        .setting-group {
            margin-bottom: 1rem;
        }
        
        .setting-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #555;
        }
        
        .setting-input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .info-section {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .info-section h2 {
            color: #333;
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
        }
        
        .info-section h3 {
            color: #007AFF;
            margin: 1.5rem 0 1rem 0;
            font-size: 1.3rem;
        }
        
        .info-section p, .info-section li {
            color: #666;
            margin-bottom: 0.8rem;
        }
        
        .info-section ul {
            padding-left: 1.5rem;
        }
        
        .footer {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 2rem 0;
            text-align: center;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .footer-links a {
            color: #666;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .footer-links a:hover {
            color: #007AFF;
        }
        
        .footer-text {
            color: #999;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            /* 导航栏样式由组件提供 */
            
            .container {
                padding: 1rem;
            
            flex: 1;}
            
            .main-content {
                padding: 2rem 1.5rem;
            
            flex: 1;}
            
            .tool-header h1 {
                font-size: 2rem;
            }
            
            .preview-grid {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
            }
            
            .footer-links {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>

    <!-- 导航栏和页脚组件 -->
    <script src="../components/navbar.js"></script>
    <script src="../components/footer.js"></script>
</head>
<body>
    <!-- 导航栏 -->
    
    <!-- 导航栏将通过JavaScript组件自动生成 -->

    <div class="container">
        <!-- 工具标题 -->
        <div class="tool-header">
            <h1>🎨 动漫图片转铅笔线稿</h1>
            <p>将动漫图片转换为铅笔线稿，适合儿童涂色使用</p>
        </div>

        <!-- 主要内容 -->
        <div class="main-content">
            <!-- 上传区域 -->
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">📸</div>
                <div class="upload-text">拖拽动漫图片到此处或点击选择文件</div>
                <div class="upload-hint">支持 JPG、PNG、GIF、BMP、WEBP 等格式</div>
                <input type="file" id="fileInput" class="file-input" accept="image/*">
            </div>

            <!-- 设置面板 -->
            <div class="settings-panel">
                <div class="settings-title">线稿设置</div>
                <div class="setting-group">
                    <label class="setting-label">边缘检测强度</label>
                    <input type="range" id="edgeStrength" class="setting-input" min="50" max="200" value="100">
                </div>
                <div class="setting-group">
                    <label class="setting-label">线条粗细</label>
                    <input type="range" id="lineThickness" class="setting-input" min="1" max="5" value="2">
                </div>
                <div class="setting-group">
                    <label class="setting-label">对比度</label>
                    <input type="range" id="contrast" class="setting-input" min="50" max="150" value="100">
                </div>
            </div>

            <!-- 预览区域 -->
            <div class="preview-container" id="previewContainer">
                <div class="preview-grid">
                    <div class="preview-item">
                        <h3>原始图片</h3>
                        <img id="originalImage" class="preview-image" alt="原始图片">
                    </div>
                    <div class="preview-item">
                        <h3>铅笔线稿</h3>
                        <canvas id="sketchCanvas" class="preview-image"></canvas>
                    </div>
                </div>

                <!-- 控制按钮 -->
                <div class="controls">
                    <button id="generateBtn" class="btn btn-primary">生成线稿</button>
                    <button id="downloadBtn" class="btn btn-success" disabled>下载线稿</button>
                    <button id="resetBtn" class="btn btn-secondary">重新选择</button>
                </div>
            </div>

            <!-- 进度条 -->
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">处理中...</div>
            </div>
        </div>

        <!-- 使用说明 -->
        <div class="info-section">
            <h2>📖 使用说明</h2>
            <h3>如何使用</h3>
            <ul>
                <li>点击上传区域或拖拽动漫图片到指定区域</li>
                <li>支持 JPG、PNG、GIF、BMP、WEBP 等常见图片格式</li>
                <li>调整线稿设置参数以获得最佳效果</li>
                <li>点击"生成线稿"按钮开始处理</li>
                <li>预览效果满意后，点击"下载线稿"保存到本地</li>
            </ul>
            
            <h3>参数说明</h3>
            <ul>
                <li><strong>边缘检测强度：</strong>控制线条的清晰度和细节程度</li>
                <li><strong>线条粗细：</strong>调整生成线稿的线条粗细</li>
                <li><strong>对比度：</strong>调整线稿的明暗对比</li>
            </ul>
            
            <h3>最佳实践</h3>
            <ul>
                <li>选择轮廓清晰、对比度较高的动漫图片效果更佳</li>
                <li>建议图片分辨率在 500x500 到 2000x2000 像素之间</li>
                <li>人物图片比风景图片更适合转换为线稿</li>
                <li>可以多次调整参数直到获得满意的效果</li>
            </ul>
        </div>

        <!-- 常见问题 -->
        <div class="info-section">
            <h2>❓ 常见问题</h2>
            
            <h3>Q: 支持哪些图片格式？</h3>
            <p>A: 支持 JPG、PNG、GIF、BMP、WEBP 等常见图片格式，推荐使用 PNG 或 JPG 格式以获得最佳效果。</p>
            
            <h3>Q: 图片大小有限制吗？</h3>
            <p>A: 建议上传的图片文件大小不超过 10MB，分辨率在 500x500 到 2000x2000 像素之间效果最佳。</p>
            
            <h3>Q: 生成的线稿不够清晰怎么办？</h3>
            <p>A: 可以尝试调整"边缘检测强度"参数，增加数值可以获得更清晰的线条，或者选择对比度更高的原图。</p>
            
            <h3>Q: 可以批量处理图片吗？</h3>
            <p>A: 目前版本支持单张图片处理，如需批量处理功能，请联系我们反馈需求。</p>
            
            <h3>Q: 生成的线稿可以商用吗？</h3>
            <p>A: 工具本身免费使用，但请确保原图片的版权合规，生成的线稿用途需遵守相关法律法规。</p>
            
            <h3>Q: 处理速度慢怎么办？</h3>
            <p>A: 处理速度取决于图片大小和设备性能，建议使用较新的浏览器，并确保网络连接稳定。</p>
        </div>
    </div>

    <!-- 底部 -->
    
    <!-- 页脚将通过JavaScript组件自动生成 -->

    <script>
        // DOM 元素
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const previewContainer = document.getElementById('previewContainer');
        const originalImage = document.getElementById('originalImage');
        const sketchCanvas = document.getElementById('sketchCanvas');
        const generateBtn = document.getElementById('generateBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const resetBtn = document.getElementById('resetBtn');
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        
        // 设置参数
        const edgeStrength = document.getElementById('edgeStrength');
        const lineThickness = document.getElementById('lineThickness');
        const contrast = document.getElementById('contrast');
        
        let currentImageFile = null;
        
        // 上传区域点击事件
        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });
        
        // 文件选择事件
        fileInput.addEventListener('change', handleFileSelect);
        
        // 拖拽事件
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });
        
        // 按钮事件
        generateBtn.addEventListener('click', generateSketch);
        downloadBtn.addEventListener('click', downloadSketch);
        resetBtn.addEventListener('click', resetTool);
        
        // 处理文件选择
        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                handleFile(file);
            }
        }
        
        // 处理文件
        function handleFile(file) {
            // 验证文件类型
            if (!file.type.startsWith('image/')) {
                alert('请选择有效的图片文件！');
                return;
            }
            
            // 验证文件大小 (10MB)
            if (file.size > 10 * 1024 * 1024) {
                alert('图片文件大小不能超过 10MB！');
                return;
            }
            
            currentImageFile = file;
            
            // 显示原图预览
            const reader = new FileReader();
            reader.onload = (e) => {
                originalImage.src = e.target.result;
                previewContainer.style.display = 'block';
                generateBtn.disabled = false;
                downloadBtn.disabled = true;
            };
            reader.readAsDataURL(file);
        }
        
        // 生成线稿
        async function generateSketch() {
            if (!currentImageFile) return;
            
            try {
                showProgress('正在处理图片...');
                generateBtn.disabled = true;
                
                // 创建图片对象
                const img = new Image();
                img.onload = () => {
                    processImageToSketch(img);
                };
                img.src = originalImage.src;
                
            } catch (error) {
                console.error('生成线稿失败:', error);
                alert('生成线稿失败，请重试！');
                hideProgress();
                generateBtn.disabled = false;
            }
        }
        
        // 图片转线稿处理
        function processImageToSketch(img) {
            const canvas = sketchCanvas;
            const ctx = canvas.getContext('2d');
            
            // 设置画布尺寸
            canvas.width = img.width;
            canvas.height = img.height;
            
            // 绘制原图
            ctx.drawImage(img, 0, 0);
            
            updateProgress(30, '正在分析图像...');
            
            // 获取图像数据
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            
            updateProgress(50, '正在生成线稿...');
            
            // 转换为灰度图
            for (let i = 0; i < data.length; i += 4) {
                const gray = data[i] * 0.299 + data[i + 1] * 0.587 + data[i + 2] * 0.114;
                data[i] = gray;
                data[i + 1] = gray;
                data[i + 2] = gray;
            }
            
            updateProgress(70, '正在检测边缘...');
            
            // 边缘检测 (Sobel算子)
            const edgeData = detectEdges(data, canvas.width, canvas.height);
            
            updateProgress(90, '正在优化线条...');
            
            // 应用设置参数
            const strength = parseInt(edgeStrength.value) / 100;
            const thickness = parseInt(lineThickness.value);
            const contrastValue = parseInt(contrast.value) / 100;
            
            // 处理边缘数据
            for (let i = 0; i < edgeData.length; i += 4) {
                let intensity = edgeData[i] * strength * contrastValue;
                intensity = Math.min(255, Math.max(0, intensity));
                
                // 反转颜色 (黑线白底)
                const value = 255 - intensity;
                edgeData[i] = value;
                edgeData[i + 1] = value;
                edgeData[i + 2] = value;
                edgeData[i + 3] = 255;
            }
            
            // 应用线条粗细
            if (thickness > 1) {
                applyLineThickness(edgeData, canvas.width, canvas.height, thickness);
            }
            
            // 绘制结果
            const resultImageData = new ImageData(edgeData, canvas.width, canvas.height);
            ctx.putImageData(resultImageData, 0, 0);
            
            updateProgress(100, '完成！');
            
            setTimeout(() => {
                hideProgress();
                generateBtn.disabled = false;
                downloadBtn.disabled = false;
            }, 500);
        }
        
        // 边缘检测算法
        function detectEdges(data, width, height) {
            const result = new Uint8ClampedArray(data.length);
            
            // Sobel算子
            const sobelX = [-1, 0, 1, -2, 0, 2, -1, 0, 1];
            const sobelY = [-1, -2, -1, 0, 0, 0, 1, 2, 1];
            
            for (let y = 1; y < height - 1; y++) {
                for (let x = 1; x < width - 1; x++) {
                    let gx = 0, gy = 0;
                    
                    for (let ky = -1; ky <= 1; ky++) {
                        for (let kx = -1; kx <= 1; kx++) {
                            const idx = ((y + ky) * width + (x + kx)) * 4;
                            const pixel = data[idx];
                            const kernelIdx = (ky + 1) * 3 + (kx + 1);
                            
                            gx += pixel * sobelX[kernelIdx];
                            gy += pixel * sobelY[kernelIdx];
                        }
                    }
                    
                    const magnitude = Math.sqrt(gx * gx + gy * gy);
                    const idx = (y * width + x) * 4;
                    
                    result[idx] = magnitude;
                    result[idx + 1] = magnitude;
                    result[idx + 2] = magnitude;
                    result[idx + 3] = 255;
                }
            }
            
            return result;
        }
        
        // 应用线条粗细
        function applyLineThickness(data, width, height, thickness) {
            const temp = new Uint8ClampedArray(data);
            const radius = Math.floor(thickness / 2);
            
            for (let y = radius; y < height - radius; y++) {
                for (let x = radius; x < width - radius; x++) {
                    const idx = (y * width + x) * 4;
                    
                    if (temp[idx] < 128) { // 如果是线条像素
                        // 在周围区域加粗
                        for (let dy = -radius; dy <= radius; dy++) {
                            for (let dx = -radius; dx <= radius; dx++) {
                                if (dx * dx + dy * dy <= radius * radius) {
                                    const newIdx = ((y + dy) * width + (x + dx)) * 4;
                                    data[newIdx] = Math.min(data[newIdx], temp[idx]);
                                    data[newIdx + 1] = Math.min(data[newIdx + 1], temp[idx]);
                                    data[newIdx + 2] = Math.min(data[newIdx + 2], temp[idx]);
                                }
                            }
                        }
                    }
                }
            }
        }
        
        // 下载线稿
        function downloadSketch() {
            const canvas = sketchCanvas;
            const link = document.createElement('a');
            link.download = `sketch_${Date.now()}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        }
        
        // 重置工具
        function resetTool() {
            currentImageFile = null;
            previewContainer.style.display = 'none';
            generateBtn.disabled = true;
            downloadBtn.disabled = true;
            fileInput.value = '';
            hideProgress();
        }
        
        // 显示进度
        function showProgress(text) {
            progressContainer.style.display = 'block';
            progressText.textContent = text;
            progressFill.style.width = '0%';
        }
        
        // 更新进度
        function updateProgress(percent, text) {
            progressFill.style.width = percent + '%';
            progressText.textContent = text;
        }
        
        // 隐藏进度
        function hideProgress() {
            progressContainer.style.display = 'none';
        }
        
        // 参数变化时自动重新生成（防抖）
        let debounceTimer;
        [edgeStrength, lineThickness, contrast].forEach(input => {
            input.addEventListener('input', () => {
                if (currentImageFile && !generateBtn.disabled) {
                    clearTimeout(debounceTimer);
                    debounceTimer = setTimeout(() => {
                        generateSketch();
                    }, 500);
                }
            });
        });
    </script>
</body>
</html>