<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>俄罗斯方块游戏- 经典俄罗斯方块小游戏戏 | 小路工具箱/title>
    <meta name="description" content="经典俄罗斯方块游戏戏！7种方块形状态，流畅操作体验，多级难度挑战，完美适配手机和电脑。重温经典益智游戏戏，挑战消息除记录，享受方块拼图乐趣！">
    <meta name="keywords" content="俄罗斯方俄罗斯方块游戏方块游戏戏,经典游戏戏,益智游戏戏,消息除游戏戏,免费游戏戏,手机游戏戏,在线游戏戏,小游戏>
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://xiaolu.tools/tools/tetris-game.html">
    <meta property="og:title" content="俄罗斯方块游戏- 经典俄罗斯方块小游戏戏">
    <meta property="og:description" content="经典俄罗斯方块游戏戏！7种方块形状态，流畅操作体验，多级难度挑战，完美适配手机和电脑>
    <meta property="og:image" content="https://xiaolu.tools/images/tetris-game.png">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://xiaolu.tools/tools/tetris-game.html">
    <meta property="twitter:title" content="俄罗斯方块游戏- 经典俄罗斯方块小游戏戏">
    <meta property="twitter:description" content="经典俄罗斯方块游戏戏！7种方块形状态，流畅操作体验，多级难度挑战，完美适配手机和电脑>
    <meta property="twitter:image" content="https://xiaolu.tools/images/tetris-game.png">
    
    <!-- 结构化数-->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Game",
        "name": "俄罗斯方块游戏,
        "description": "经典俄罗斯方块游戏戏，7种方块形状态，流畅操作体验",
        "url": "https://xiaolu.tools/tools/tetris-game.html",
        "genre": "Puzzle",
        "gamePlatform": "Web Browser",
        "operatingSystem": "All"
    }
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .game-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .game-header {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .game-title {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .game-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .game-section {
            padding: 40px;
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .game-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(155, 89, 182, 0.3);
        }
        
        .control-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .game-canvas-container {
            position: relative;
            border: 3px solid #9b59b6;
            border-radius: 10px;
            background: #000;
        }
        
        #gameCanvas {
            display: block;
            background: #000;
        }
        
        .game-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .game-overlay.hidden {
            display: none;
        }
        
        .game-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            min-width: 200px;
        }
        
        .info-item {
            margin-bottom: 15px;
            text-align: center;
        }
        
        .info-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        .info-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #9b59b6;
        }
        
        .next-piece {
            border: 2px solid #9b59b6;
            border-radius: 8px;
            background: #000;
            margin: 10px auto;
        }
        
        .mobile-controls {
            display: none;
            grid-template-areas: 
                ". rotate ."
                "left down right"
                ". drop .";
            grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: 1fr 1fr 1fr;
            gap: 10px;
            max-width: 200px;
            margin: 20px auto;
        }
        
        .action-btn {
            width: 60px;
            height: 60px;
            border: 2px solid #9b59b6;
            background: white;
            color: #9b59b6;
            border-radius: 8px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .action-btn:hover {
            background: #9b59b6;
            color: white;
        }
        
        .action-btn:active {
            transform: scale(0.95);
        }
        
        .btn-rotate { grid-area: rotate; }
        .btn-left { grid-area: left; }
        .btn-down { grid-area: down; }
        .btn-right { grid-area: right; }
        .btn-drop { grid-area: drop; }
        
        .game-status {
            margin: 20px 0;
            font-size: 1.1rem;
            font-weight: 600;
            text-align: center;
        }
        
        .status-playing {
            color: #9b59b6;
        }
        
        .status-paused {
            color: #f39c12;
        }
        
        .status-gameover {
            color: #e74c3c;
        }
        
        .level-progress {
            background: #e9ecef;
            border-radius: 10px;
            height: 10px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .level-progress-bar {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .info-section {
            padding: 40px;
            background: white;
        }
        
        .info-title {
            font-size: 1.8rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 25px;
            text-align: center;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }
        
        .info-card {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border-left: 4px solid #9b59b6;
        }
        
        .info-card h3 {
            color: #9b59b6;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .info-card ul {
            list-style: none;
            padding: 0;
        }
        
        .info-card li {
            padding: 5px 0;
            position: relative;
            padding-left: 20px;
        }
        
        .info-card li: before {
            content: ";
            position: absolute;
            left: 0;
            color: #9b59b6;
            font-weight: bold;
        }
        
        .highlight-box {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin: 30px 0;
        }
        
        .highlight-number {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .footer-info {
            background: #f8f9fa;
            padding: 30px;
            text-align: center;
            border-top: 1px solid #e9ecef;
        }
        
        .footer-links {
            margin-top: 15px;
        }
        
        .footer-links a {
            color: #9b59b6;
            text-decoration: none;
            margin: 0 15px;
            font-weight: 500;
        }
        
        .footer-links a:hover {
            text-decoration: underline;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .game-title {
                font-size: 2rem;
            }
            
            .game-subtitle {
                font-size: 1rem;
            }
            
            .game-section {
                padding: 25px 20px;
                flex-direction: column;
                align-items: center;
            }
            
            #gameCanvas {
                width: 300px !important;
                height: 600px !important;
            }
            
            .mobile-controls {
                display: grid;
            }
            
            .game-info {
                order: -1;
                display: flex;
                justify-content: space-around;
                flex-wrap: wrap;
                width: 100%;
                max-width: 350px;
            }
            
            .info-item {
                margin-bottom: 10px;
                flex: 1;
                min-width: 80px;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- 导航栏栏占位符 -->
    <div id="navbar-container"></div>
    
    <div class="container">
        <div class="game-container">
            <!-- 游戏戏标题和介-->
            <div class="game-header">
                <h1 class="game-title">俄罗斯方块游戏/h1>
                <p class="game-subtitle">经典俄罗斯方块小游戏戏种方块形状态，流畅操作体验，多级难度挑战。控制方块下落，消息除完整行，挑战最高分数和等级/p>
            </div>
            
            <!-- 游戏戏功能-->
            <div class="game-section">
                <div class="game-area">
                    <!-- 游戏戏控制 -->
                    <div class="game-controls">
                        <button class="control-btn" onclick="startGame()"> 开始游戏/button>
                        <button class="control-btn" onclick="pauseGame()" id="pause-btn"> 暂停</button>
                        <button class="control-btn" onclick="resetGame()"> 重新开/button>
                    </div>
                    
                    <!-- 游戏戏画布 -->
                    <div class="game-canvas-container">
                        <canvas id="gameCanvas" width="300" height="600"></canvas>
                        <div class="game-overlay" id="game-overlay">
                            <div> 俄罗斯方/div>
                            <div style="font-size: 1rem; margin-top: 10px;">点击"开始游戏开/div>
                            <div style="font-size: 0.9rem; margin-top: 10px; opacity: 0.8;">使用方向键或屏幕按钮控制</div>
                        </div>
                    </div>
                    
                    <!-- 移动端控制按-->
                    <div class="mobile-controls" id="mobile-controls">
                        <button class="action-btn btn-rotate" onclick="rotatePiece()">/button>
                        <button class="action-btn btn-left" onclick="movePiece(-1)">/button>
                        <button class="action-btn btn-down" onclick="movePieceDown()">/button>
                        <button class="action-btn btn-right" onclick="movePiece(1)">/button>
                        <button class="action-btn btn-drop" onclick="dropPiece()">/button>
                    </div>
                </div>
                
                <!-- 游戏戏信息面板 -->
                <div class="game-info">
                    <div class="info-item">
                        <div class="info-label">分数</div>
                        <div class="info-value" id="score">0</div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-label">等级</div>
                        <div class="info-value" id="level">1</div>
                        <div class="level-progress">
                            <div class="level-progress-bar" id="level-progress"></div>
                        </div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-label">消息除行数</div>
                        <div class="info-value" id="lines">0</div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-label">下一个方/div>
                        <canvas class="next-piece" id="nextCanvas" width="80" height="80"></canvas>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-label">最高分</div>
                        <div class="info-value" id="high-score">0</div>
                    </div>
                </div>
            </div>
            
            <!-- 游戏戏状态-->
            <div class="game-status" id="game-status">
                <span class="status-playing"> 使用方向键控制方块移动和旋转</span>
            </div>
            
            <!-- 使用指南和详细介-->
            <div class="info-section">
                <h2 class="info-title"> 俄罗斯方块游戏戏完全指/h2>
                
                <div class="info-grid">
                    <div class="info-card">
                        <h3> 游戏戏规则</h3>
                        <ul>
                            <li>控制下落的方块移动和旋转</li>
                            <li>将方块拼接成完整的水平行</li>
                            <li>完整的行会被消息除并获得分/li>
                            <li>同时消息除多行可获得更高分/li>
                            <li>方块堆积到顶部游戏戏结/li>
                            <li>随着等级提升，下落速度加快</li>
                        </ul>
                    </div>
                    
                    <div class="info-card">
                        <h3>操作指南</h3>
                        <ul>
                            <li>电脑端：方向移动， 旋转， 加速下/li>
                            <li>空格键：瞬间下落到底/li>
                            <li>手机端：点击屏幕上的控制按钮</li>
                            <li>P键或点击暂停按钮暂停游戏戏</li>
                            <li>支持连续按键操作</li>
                            <li>可以预览下一个方块形/li>
                        </ul>
                    </div>
                    
                    <div class="info-card">
                        <h3> 方块类型</h3>
                        <ul>
                            <li>I型：直线方块，最适合消息除四行</li>
                            <li>O型：正方形方块，稳定易放/li>
                            <li>T型：T字形方块，旋转变化多</li>
                            <li>S型：S字形方块，适合填补空隙</li>
                            <li>Z型：Z字形方块，与S型互/li>
                            <li>J型：J字形方块，适合边角填充</li>
                            <li>L型：L字形方块，与J型对/li>
                        </ul>
                    </div>
                    
                    <div class="info-card">
                        <h3> 游戏戏技/h3>
                        <ul>
                            <li>保持底部平整，避免留下空/li>
                            <li>学会T-Spin等高级技/li>
                            <li>合理利用I型方块消息除多/li>
                            <li>提前规划方块放置位置</li>
                            <li>观察下一个方块做好准/li>
                            <li>在高速下保持冷静操作</li>
                        </ul>
                    </div>
                    
                    <div class="info-card">
                        <h3> 计分系统</h3>
                        <ul>
                            <li>消息除1行：100 等级</li>
                            <li>消息除2行：300 等级</li>
                            <li>消息除3行：500 等级</li>
                            <li>消息除4行：800 等级（俄罗斯方块/li>
                            <li>软降：每/li>
                            <li>硬降：每/li>
                        </ul>
                    </div>
                    
                    <div class="info-card">
                        <h3> 应用场景</h3>
                        <ul>
                            <li>休闲娱乐：工作间隙放松大/li>
                            <li>反应训练：提升手眼协调能/li>
                            <li>空间思维：锻炼几何想象力</li>
                            <li>策略规划：培养前瞻性思/li>
                            <li>压力释放：专注游戏戏缓解焦/li>
                            <li>竞技挑战：与朋友比拼高分</li>
                        </ul>
                    </div>
                </div>
                
                <div class="highlight-box">
                    <div class="highlight-number"></div>
                    <p>经典俄罗斯方块游戏戏，简单规则下的无限可能，挑战你的空间思维和反应速度</p>
                </div>
            </div>
            
            <!-- 页脚信息 -->
            <div class="footer-info">
                <p>@2025 俄罗斯方块游戏- 经典益智游戏戏，锻炼空间思维</p>
                <div class="footer-links">
                    <a href="https://t.zsxq.com/17wTksRxX" target="_blank">技术支/a>
                    <a href="https://t.zsxq.com/17wTksRxX" target="_blank">问题反馈</a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 页脚占位符-->
    <div id="footer-container"></div>
    
    <script>
        // 游戏戏变量
        let canvas, ctx, nextCanvas, nextCtx;
        let gameBoard = [];
        let currentPiece = null;
        let nextPiece = null;
        let gameRunning = false;
        let gamePaused = false;
        let gameLoop = null;
        let dropTimer = null;
        
        // 游戏戏统计
        let score = 0;
        let level = 1;
        let lines = 0;
        let dropSpeed = 1000; // 毫秒
        
        // 游戏戏配置
        const BOARD_WIDTH = 10;
        const BOARD_HEIGHT = 20;
        const BLOCK_SIZE = 30;
        
        // 方块形状态定义
        const PIECES = {
            I: {
                shape: [
                    [1, 1, 1, 1]
                ],
                color: '#00f5ff'
            },
            O: {
                shape: [
                    [1, 1],
                    [1, 1]
                ],
                color: '#ffff00'
            },
            T: {
                shape: [
                    [0, 1, 0],
                    [1, 1, 1]
                ],
                color: '#a000f0'
            },
            S: {
                shape: [
                    [0, 1, 1],
                    [1, 1, 0]
                ],
                color: '#00f000'
            },
            Z: {
                shape: [
                    [1, 1, 0],
                    [0, 1, 1]
                ],
                color: '#f00000'
            },
            J: {
                shape: [
                    [1, 0, 0],
                    [1, 1, 1]
                ],
                color: '#0000f0'
            },
            L: {
                shape: [
                    [0, 0, 1],
                    [1, 1, 1]
                ],
                color: '#f0a000'
            }
        };
        
        // 初始化游戏        function initGame() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            nextCanvas = document.getElementById('nextCanvas');
            nextCtx = nextCanvas.getContext('2d');
            
            // 初始化游戏戏板
            initBoard();
            
            // 加载最高分
            loadHighScore();
            
            // 绘制初始状态            draw();
            
            // 添加键盘事件监听
            document.addEventListener('keydown', handleKeyPress);
        }
        
        // 初始化游戏戏板
        function initBoard() {
            gameBoard = [];
            for (let row = 0; row < BOARD_HEIGHT; row++) {
                gameBoard[row] = [];
                for (let col = 0; col < BOARD_WIDTH; col++) {
                    gameBoard[row][col] = 0;
                }
            }
        }
        
        // 创建新方        function createPiece(type) {
            const pieceData = PIECES[type];
            return {
                type: type,
                shape: pieceData.shape.map(row => [...row]),
                color: pieceData.color,
                x: Math.floor(BOARD_WIDTH / 2) - Math.floor(pieceData.shape[0].length / 2),
                y: 0
            };
        }
        
        // 获取随机方块类型
        function getRandomPieceType() {
            const types = Object.keys(PIECES);
            return types[Math.floor(Math.random() * types.length)];
        }
        
        // 开始游戏        function startGame() {
            if (gameRunning && !gamePaused) return;
            
            if (!gameRunning) {
                resetGame();
            }
            
            gameRunning = true;
            gamePaused = false;
            
            // 创建第一个方            if (!currentPiece) {
                currentPiece = createPiece(getRandomPieceType());
                nextPiece = createPiece(getRandomPieceType());
            }
            
            document.getElementById('game-overlay').classList.add('hidden');
            document.getElementById('pause-btn').textContent = ' 暂停';
            
            startDropTimer();
            updateGameStatus(' 游戏戏进行中，使用方向键控制方, 'status-playing');
        }
        
        // 暂停游戏戏
        function pauseGame() {
            if (!gameRunning) return;
            
            if (gamePaused) {
                // 恢复游戏戏
                gamePaused = false;
                document.getElementById('game-overlay').classList.add('hidden');
                document.getElementById('pause-btn').textContent = ' 暂停';
                startDropTimer();
                updateGameStatus(' 游戏戏进行中，使用方向键控制方, 'status-playing');
            } else {
                // 暂停游戏戏
                gamePaused = true;
                clearInterval(dropTimer);
                document.getElementById('game-overlay').classList.remove('hidden');
                document.getElementById('game-overlay').innerHTML = `
                    <div> 游戏戏已暂/div>
                    <div style="font-size: 1rem; margin-top: 10px;">点击"暂停"按钮继续游戏戏</div>
                `;
                document.getElementById('pause-btn').textContent = ' 继续';
                updateGameStatus(' 游戏戏已暂, 'status-paused');
            }
        }
        
        // 重置游戏戏
        function resetGame() {
            gameRunning = false;
            gamePaused = false;
            clearInterval(dropTimer);
            
            // 重置游戏戏状态            score = 0;
            level = 1;
            lines = 0;
            dropSpeed = 1000;
            currentPiece = null;
            nextPiece = null;
            
            // 重置游戏戏            initBoard();
            
            // 更新显示
            updateScore();
            updateLevel();
            updateLines();
            
            document.getElementById('game-overlay').classList.remove('hidden');
            document.getElementById('game-overlay').innerHTML = `
                <div> 俄罗斯方/div>
                <div style="font-size: 1rem; margin-top: 10px;">点击"开始游戏开/div>
                <div style="font-size: 0.9rem; margin-top: 10px; opacity: 0.8;">使用方向键或屏幕按钮控制</div>
            `;
            document.getElementById('pause-btn').textContent = ' 暂停';
            
            draw();
            updateGameStatus(' 使用方向键控制方块移动和旋转', 'status-playing');
        }
        
        // 开始下落计时器
        function startDropTimer() {
            clearInterval(dropTimer);
            dropTimer = setInterval(() => {
                if (gameRunning && !gamePaused) {
                    movePieceDown();
                }
            }, dropSpeed);
        }
        
        // 移动方块
        function movePiece(direction) {
            if (!gameRunning || gamePaused || !currentPiece) return;
            
            const newX = currentPiece.x + direction;
            if (isValidPosition(currentPiece.shape, newX, currentPiece.y)) {
                currentPiece.x = newX;
                draw();
            }
        }
        
        // 方块下移
        function movePieceDown() {
            if (!gameRunning || gamePaused || !currentPiece) return;
            
            const newY = currentPiece.y + 1;
            if (isValidPosition(currentPiece.shape, currentPiece.x, newY)) {
                currentPiece.y = newY;
                score += 1; // 软降分数
                updateScore();
                draw();
            } else {
                // 方块着                placePiece();
                clearLines();
                spawnNewPiece();
            }
        }
        
        // 旋转方块
        function rotatePiece() {
            if (!gameRunning || gamePaused || !currentPiece) return;
            
            const rotatedShape = rotateMatrix(currentPiece.shape);
            if (isValidPosition(rotatedShape, currentPiece.x, currentPiece.y)) {
                currentPiece.shape = rotatedShape;
                draw();
            }
        }
        
        // 瞬间下落
        function dropPiece() {
            if (!gameRunning || gamePaused || !currentPiece) return;
            
            let dropDistance = 0;
            while (isValidPosition(currentPiece.shape, currentPiece.x, currentPiece.y + 1)) {
                currentPiece.y++;
                dropDistance++;
            }
            
            score += dropDistance * 2; // 硬降分数
            updateScore();
            
            // 方块着            placePiece();
            clearLines();
            spawnNewPiece();
        }
        
        // 旋转矩阵
        function rotateMatrix(matrix) {
            const rows = matrix.length;
            const cols = matrix[0].length;
            const rotated = [];
            
            for (let col = 0; col < cols; col++) {
                rotated[col] = [];
                for (let row = rows - 1; row >= 0; row--) {
                    rotated[col][rows - 1 - row] = matrix[row][col];
                }
            }
            
            return rotated;
        }
        
        // 检查位置是否有        function isValidPosition(shape, x, y) {
            for (let row = 0; row < shape.length; row++) {
                for (let col = 0; col < shape[row].length; col++) {
                    if (shape[row][col]) {
                        const newX = x + col;
                        const newY = y + row;
                        
                        // 检查边                        if (newX < 0 || newX >= BOARD_WIDTH || newY >= BOARD_HEIGHT) {
                            return false;
                        }
                        
                        // 检查碰                        if (newY >= 0 && gameBoard[newY][newX]) {
                            return false;
                        }
                    }
                }
            }
            return true;
        }
        
        // 放置方块
        function placePiece() {
            for (let row = 0; row < currentPiece.shape.length; row++) {
                for (let col = 0; col < currentPiece.shape[row].length; col++) {
                    if (currentPiece.shape[row][col]) {
                        const x = currentPiece.x + col;
                        const y = currentPiece.y + row;
                        
                        if (y >= 0) {
                            gameBoard[y][x] = currentPiece.color;
                        }
                    }
                }
            }
        }
        
        // 清除完整        function clearLines() {
            let linesCleared = 0;
            
            for (let row = BOARD_HEIGHT - 1; row >= 0; row--) {
                if (gameBoard[row].every(cell => cell !== 0)) {
                    // 移除完整                    gameBoard.splice(row, 1);
                    // 在顶部添加新的空                    gameBoard.unshift(new Array(BOARD_WIDTH).fill(0));
                    linesCleared++;
                    row++; // 重新检查当前行
                }
            }
            
            if (linesCleared > 0) {
                // 计算器分数
                const lineScores = [0, 100, 300, 500, 800];
                score += lineScores[linesCleared] * level;
                
                lines += linesCleared;
                
                // 升级检                const newLevel = Math.floor(lines / 10) + 1;
                if (newLevel > level) {
                    level = newLevel;
                    dropSpeed = Math.max(50, 1000 - (level - 1) * 100);
                    startDropTimer();
                }
                
                updateScore();
                updateLevel();
                updateLines();
            }
        }
        
        // 生成新方        function spawnNewPiece() {
            currentPiece = nextPiece;
            nextPiece = createPiece(getRandomPieceType());
            
            // 检查游戏戏是否结            if (!isValidPosition(currentPiece.shape, currentPiece.x, currentPiece.y)) {
                gameOver();
                return;
            }
            
            draw();
        }
        
        // 游戏戏结束
        function gameOver() {
            gameRunning = false;
            gamePaused = false;
            clearInterval(dropTimer);
            
            // 检查最高分
            const highScore = parseInt(localStorage.getItem('tetrisHighScore') || '0');
            if (score > highScore) {
                localStorage.setItem('tetrisHighScore', score.toString());
                document.getElementById('high-score').textContent = score;
            }
            
            document.getElementById('game-overlay').classList.remove('hidden');
            document.getElementById('game-overlay').innerHTML = `
                <div> 游戏戏结束</div>
                <div style="font-size: 1.2rem; margin-top: 10px;">最终分 ${score}</div>
                <div style="font-size: 1rem; margin-top: 10px;">等级: ${level} | 消息除: ${lines}/div>
                <div style="font-size: 0.9rem; margin-top: 15px; opacity: 0.8;">点击"重新开再来一局</div>
            `;
            
            updateGameStatus(' 游戏戏结束！点击重新开始再来一局', 'status-gameover');
        }
        
        // 绘制游戏戏
        function draw() {
            // 清空画布
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 绘制游戏戏            for (let row = 0; row < BOARD_HEIGHT; row++) {
                for (let col = 0; col < BOARD_WIDTH; col++) {
                    if (gameBoard[row][col]) {
                        ctx.fillStyle = gameBoard[row][col];
                        ctx.fillRect(
                            col * BLOCK_SIZE + 1,
                            row * BLOCK_SIZE + 1,
                            BLOCK_SIZE - 2,
                            BLOCK_SIZE - 2
                        );
                    }
                }
            }
            
            // 绘制当前方块
            if (currentPiece) {
                ctx.fillStyle = currentPiece.color;
                for (let row = 0; row < currentPiece.shape.length; row++) {
                    for (let col = 0; col < currentPiece.shape[row].length; col++) {
                        if (currentPiece.shape[row][col]) {
                            const x = (currentPiece.x + col) * BLOCK_SIZE;
                            const y = (currentPiece.y + row) * BLOCK_SIZE;
                            
                            ctx.fillRect(x + 1, y + 1, BLOCK_SIZE - 2, BLOCK_SIZE - 2);
                        }
                    }
                }
            }
            
            // 绘制网格格            ctx.strokeStyle = '#333';
            ctx.lineWidth = 1;
            for (let i = 0; i <= BOARD_WIDTH; i++) {
                ctx.beginPath();
                ctx.moveTo(i * BLOCK_SIZE, 0);
                ctx.lineTo(i * BLOCK_SIZE, canvas.height);
                ctx.stroke();
            }
            for (let i = 0; i <= BOARD_HEIGHT; i++) {
                ctx.beginPath();
                ctx.moveTo(0, i * BLOCK_SIZE);
                ctx.lineTo(canvas.width, i * BLOCK_SIZE);
                ctx.stroke();
            }
            
            // 绘制下一个方            drawNextPiece();
        }
        
        // 绘制下一个方        function drawNextPiece() {
            nextCtx.fillStyle = '#000';
            nextCtx.fillRect(0, 0, nextCanvas.width, nextCanvas.height);
            
            if (nextPiece) {
                const blockSize = 15;
                const offsetX = (nextCanvas.width - nextPiece.shape[0].length * blockSize) / 2;
                const offsetY = (nextCanvas.height - nextPiece.shape.length * blockSize) / 2;
                
                nextCtx.fillStyle = nextPiece.color;
                for (let row = 0; row < nextPiece.shape.length; row++) {
                    for (let col = 0; col < nextPiece.shape[row].length; col++) {
                        if (nextPiece.shape[row][col]) {
                            nextCtx.fillRect(
                                offsetX + col * blockSize + 1,
                                offsetY + row * blockSize + 1,
                                blockSize - 2,
                                blockSize - 2
                            );
                        }
                    }
                }
            }
        }
        
        // 键盘事件处理
        function handleKeyPress(event) {
            if (!gameRunning || gamePaused) {
                if (event.key === 'p' || event.key === 'P') {
                    pauseGame();
                }
                return;
            }
            
            switch (event.key) {
                case 'ArrowLeft':
                    movePiece(-1);
                    break;
                case 'ArrowRight':
                    movePiece(1);
                    break;
                case 'ArrowDown':
                    movePieceDown();
                    break;
                case 'ArrowUp':
                    rotatePiece();
                    break;
                case ' ':
                    event.preventDefault();
                    dropPiece();
                    break;
                case 'p':
                case 'P':
                    pauseGame();
                    break;
            }
        }
        
        // 更新分数显示
        function updateScore() {
            document.getElementById('score').textContent = score;
        }
        
        // 更新等级显示
        function updateLevel() {
            document.getElementById('level').textContent = level;
            const progress = ((lines % 10) / 10) * 100;
            document.getElementById('level-progress').style.width = progress + '%';
        }
        
        // 更新消息除行数显示
        function updateLines() {
            document.getElementById('lines').textContent = lines;
        }
        
        // 更新游戏戏状态        function updateGameStatus(message, className) {
            const statusElement = document.getElementById('game-status');
            statusElement.innerHTML = `<span class="${className}">${message}</span>`;
        }
        
        // 加载最高分
        function loadHighScore() {
            const highScore = localStorage.getItem('tetrisHighScore') || '0';
            document.getElementById('high-score').textContent = highScore;
        }
        
        // 页面加载完成后初始化游戏戏
        document.addEventListener('DOMContentLoaded', function() {
            initGame();
            

        });
    </script>
    
    <script src="../components/component-manager.js"></script>
</body>
</html>
