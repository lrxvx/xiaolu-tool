<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <!-- 导航栏和页脚组件 -->
    <script src="../components/navbar.js"></script>
    <script src="../components/footer.js"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片格式转换工具 - 小路工具箱</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="免费在线图片格式转换工具，支持图片转Word、图片转Excel、图片转PDF、合并长图，支持JPG、PNG、GIF、BMP等多种格式，本地处理保护隐私。">
    <meta name="keywords" content="图片转换,图片转Word,图片转Excel,图片转PDF,合并长图,在线图片转换,免费图片转换工具,JPG转换,PNG转换">
    <meta name="author" content="小路工具箱">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://xiaolu-tool.com/tools/image-format-converter.html">
    <meta property="og:title" content="图片格式转换工具 - 小路工具箱">
    <meta property="og:description" content="免费在线图片格式转换工具，支持图片转Word、图片转Excel、图片转PDF、合并长图，本地处理保护隐私。">
    <meta property="og:image" content="https://xiaolu-tool.com/images/image-converter-preview.jpg">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://xiaolu-tool.com/tools/image-format-converter.html">
    <meta property="twitter:title" content="图片格式转换工具 - 小路工具箱">
    <meta property="twitter:description" content="免费在线图片格式转换工具，支持图片转Word、图片转Excel、图片转PDF、合并长图，本地处理保护隐私。">
    <meta property="twitter:image" content="https://xiaolu-tool.com/images/image-converter-preview.jpg">
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "图片格式转换工具",
        "description": "免费在线图片格式转换工具，支持图片转Word、图片转Excel、图片转PDF、合并长图",
        "url": "https://xiaolu-tool.com/tools/image-format-converter.html",
        "applicationCategory": "UtilitiesApplication",
        "operatingSystem": "Any",
        "permissions": "browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "CNY"
        },
        "creator": {
            "@type": "Organization",
            "name": "小路工具箱"
        }
    }
    </script>
    
    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.8.2/docx.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/file-saver/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --success: #06d6a0;
            --warning: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --border: #dee2e6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        
            display: flex;
            flex-direction: column;}
        
        .nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 0;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }
        
        /* 导航栏样式由组件提供 */
        
        /* 导航栏样式由组件提供 */
        
        /* 导航栏样式由组件提供 */
        
        /* 导航栏样式由组件提供 */
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        
            flex: 1;}
        
        .tool-/* 导航栏样式由组件提供 */
        
        .tool-header h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .tool-header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .main-content {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        
            flex: 1;}
        
        .upload-area {
            border: 3px dashed var(--border);
            border-radius: 15px;
            padding: 3rem;
            text-align: center;
            margin-bottom: 2rem;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .upload-area:hover {
            border-color: var(--primary);
            background-color: rgba(67, 97, 238, 0.05);
        }
        
        .upload-area.dragover {
            border-color: var(--success);
            background-color: rgba(6, 214, 160, 0.1);
        }
        
        .upload-icon {
            font-size: 4rem;
            color: var(--gray);
            margin-bottom: 1rem;
        }
        
        .upload-text {
            font-size: 1.2rem;
            color: var(--gray);
            margin-bottom: 1rem;
        }
        
        .file-input {
            display: none;
        }
        
        .upload-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .upload-btn:hover {
            background: var(--secondary);
        }
        
        .image-preview {
            display: none;
            margin-bottom: 2rem;
        }
        
        .preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .preview-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            cursor: move;
            background: white;
            transition: transform 0.3s;
        }
        
        .preview-item:hover {
            transform: scale(1.05);
        }
        
        .preview-item.sortable-ghost {
            opacity: 0.5;
        }
        
        .preview-item.sortable-drag {
            transform: rotate(5deg);
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }
        
        .preview-img {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }
        
        .image-order {
            position: absolute;
            top: 5px;
            left: 5px;
            background: rgba(67, 97, 238, 0.9);
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 255, 255, 0.9);
            color: var(--warning);
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .remove-btn:hover {
            background: var(--warning);
            color: white;
        }
        
        .drag-handle {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border-radius: 4px;
            padding: 2px 4px;
            font-size: 0.7rem;
            pointer-events: none;
        }
        
        .format-selection {
            margin-bottom: 2rem;
        }
        
        .format-selection h3 {
            margin-bottom: 1rem;
            color: var(--dark);
        }
        
        .format-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .format-option {
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .format-option:hover {
            border-color: var(--primary);
            background-color: rgba(67, 97, 238, 0.05);
        }
        
        .format-option.selected {
            border-color: var(--primary);
            background-color: rgba(67, 97, 238, 0.1);
        }
        
        .format-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .format-icon.word { color: #2b579a; }
        .format-icon.excel { color: #217346; }
        .format-icon.pdf { color: #dc3545; }
        .format-icon.long-image { color: #9b59b6; }
        
        .convert-btn {
            background: var(--success);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: background 0.3s;
            width: 100%;
            margin-bottom: 2rem;
        }
        
        .convert-btn:hover {
            background: #05c085;
        }
        
        .convert-btn:disabled {
            background: var(--gray);
            cursor: not-allowed;
        }
        
        .progress-container {
            display: none;
            margin-bottom: 2rem;
        }
        
        .progress-bar {
            background: var(--light);
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            margin-bottom: 1rem;
        }
        
        .progress-fill {
            background: var(--success);
            height: 100%;
            width: 0%;
            transition: width 0.3s;
        }
        
        .progress-text {
            text-align: center;
            color: var(--gray);
        }
        
        .result-container {
            display: none;
            background: var(--light);
            border-radius: 10px;
            padding: 1.5rem;
            text-align: center;
        }
        
        .download-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s;
            text-decoration: none;
            display: inline-block;
        }
        
        .download-btn:hover {
            background: var(--secondary);
        }
        
        .info-section {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .info-section h2 {
            color: var(--primary);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .info-section h3 {
            color: var(--dark);
            margin: 1.5rem 0 1rem 0;
        }
        
        .info-section ul {
            padding-left: 1.5rem;
        }
        
        .info-section li {
            margin-bottom: 0.5rem;
        }
        
        .footer {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 2rem 0;
            text-align: center;
            color: var(--gray);
        }
        
        .footer a {
            color: var(--primary);
            text-decoration: none;
        }
        
        .footer a:hover {
            text-decoration: underline;
        }
        
        @media (max-width: 768px) {
            .nav-container {
                padding: 0 1rem;
            }
            
            .container {
                padding: 0 1rem;
            
            flex: 1;}
            
            .tool-header h1 {
                font-size: 2rem;
            }
            
            .format-options {
                grid-template-columns: 1fr;
            }
            
            /* 导航栏样式由组件提供 */
        }
    </style>

    <!-- 导航栏和页脚组件 -->
    <script src="../components/navbar.js"></script>
    <script src="../components/footer.js"></script>
</head>
<body>
    <!-- Navigation -->
    
    <!-- 导航栏将通过JavaScript组件自动生成 -->

    <div class="container">
        <!-- Tool Header -->
        <div class="tool-header">
            <h1><i class="fas fa-images"></i> 图片格式转换工具</h1>
            <p>支持图片转Word、Excel、PDF、合并长图等多种格式转换</p>
        </div>

        <!-- Main Tool -->
        <div class="main-content">
            <!-- Upload Area -->
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <div class="upload-text">
                    拖拽图片到此处或点击选择文件
                </div>
                <div class="upload-text" style="font-size: 0.9rem; color: var(--gray);">
                    支持 JPG、PNG、GIF、BMP、WEBP 等格式，可选择多个文件
                </div>
                <input type="file" id="fileInput" class="file-input" multiple accept="image/*">
                <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                    <i class="fas fa-folder-open"></i> 选择图片
                </button>
            </div>

            <!-- Image Preview -->
            <div class="image-preview" id="imagePreview">
                <h3>已选择的图片 (<span id="imageCount">0</span>)</h3>
                <div class="preview-grid" id="previewGrid"></div>
            </div>

            <!-- Format Selection -->
            <div class="format-selection">
                <h3>选择转换格式</h3>
                <div class="format-options">
                    <div class="format-option" data-format="word" onclick="selectFormat('word')">
                        <div class="format-icon word">
                            <i class="fas fa-file-word"></i>
                        </div>
                        <h4>图片转Word</h4>
                        <p>将图片插入Word文档</p>
                    </div>
                    <div class="format-option" data-format="excel" onclick="selectFormat('excel')">
                        <div class="format-icon excel">
                            <i class="fas fa-file-excel"></i>
                        </div>
                        <h4>图片转Excel</h4>
                        <p>将图片插入Excel表格</p>
                    </div>
                    <div class="format-option" data-format="pdf" onclick="selectFormat('pdf')">
                        <div class="format-icon pdf">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <h4>图片转PDF</h4>
                        <p>将图片转换为PDF文档</p>
                    </div>
                    <div class="format-option" data-format="long-image" onclick="selectFormat('long-image')">
                        <div class="format-icon long-image">
                            <i class="fas fa-image"></i>
                        </div>
                        <h4>合并长图</h4>
                        <p>将多张图片合并为长图</p>
                    </div>
                </div>
            </div>

            <!-- Convert Button -->
            <button class="convert-btn" id="convertBtn" onclick="startConversion()" disabled>
                <i class="fas fa-magic"></i> 开始转换
            </button>

            <!-- Progress -->
            <div class="progress-container" id="progressContainer">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">正在处理...</div>
            </div>

            <!-- Result -->
            <div class="result-container" id="resultContainer">
                <h3><i class="fas fa-check-circle" style="color: var(--success);"></i> 转换完成！</h3>
                <p>您的文件已准备好下载</p>
                <a href="#" class="download-btn" id="downloadBtn" download>
                    <i class="fas fa-download"></i> 下载文件
                </a>
            </div>
        </div>

        <!-- Usage Instructions -->
        <div class="info-section">
            <h2><i class="fas fa-question-circle"></i> 使用说明</h2>
            
            <h3>如何使用图片格式转换工具？</h3>
            <ol>
                <li><strong>上传图片：</strong>点击"选择图片"按钮或直接拖拽图片到上传区域</li>
                <li><strong>调整顺序：</strong>在预览区域拖拽图片可以自定义排列顺序</li>
                <li><strong>选择格式：</strong>根据需要选择转换格式（Word、Excel、PDF、长图）</li>
                <li><strong>开始转换：</strong>点击"开始转换"按钮，等待处理完成</li>
                <li><strong>下载结果：</strong>转换完成后点击下载按钮保存文件</li>
            </ol>
            
            <h3>拖拽排序功能</h3>
            <ul>
                <li><strong>自定义顺序：</strong>在图片预览区域，您可以通过拖拽来调整图片的排列顺序</li>
                <li><strong>实时更新：</strong>拖拽后序号会自动更新，最终生成的文档将按照您设定的顺序排列</li>
                <li><strong>操作简单：</strong>鼠标悬停在图片上即可看到拖拽手柄，点击并拖拽即可</li>
            </ul>
            
            <h3>支持的图片格式</h3>
            <ul>
                <li><strong>JPG/JPEG：</strong>最常用的图片格式，适合照片</li>
                <li><strong>PNG：</strong>支持透明背景的图片格式</li>
                <li><strong>GIF：</strong>支持动画的图片格式</li>
                <li><strong>BMP：</strong>Windows位图格式</li>
                <li><strong>WEBP：</strong>现代高效的图片格式</li>
            </ul>
            
            <h3>转换格式说明</h3>
            <ul>
                <li><strong>图片转Word：</strong>生成真正的.docx文档，图片按顺序高清嵌入，支持Office软件打开编辑</li>
                <li><strong>图片转Excel：</strong>生成真正的.xlsx文件，图片嵌入表格预览列，包含详细信息统计</li>
                <li><strong>图片转PDF：</strong>将图片转换为高质量PDF文档，保持原始分辨率，便于分享和打印</li>
                <li><strong>合并长图：</strong>将多张图片垂直拼接成一张长图，支持PNG格式输出，适合制作长图海报</li>
            </ul>
        </div>

        <!-- FAQ -->
        <div class="info-section">
            <h2><i class="fas fa-lightbulb"></i> 常见问题</h2>
            
            <h3>Q: 支持哪些图片格式？</h3>
            <p>A: 支持JPG、PNG、GIF、BMP、WEBP等常见图片格式，可以同时上传多个不同格式的图片。</p>
            
            <h3>Q: 有文件大小限制吗？</h3>
            <p>A: 为了确保转换速度和浏览器性能，建议单个图片文件不超过10MB，总文件大小不超过50MB。</p>
            
            <h3>Q: 转换后的文件质量如何？</h3>
            <p>A: 转换过程会保持原图片的分辨率和质量，生成的Word、Excel、PDF文件都是真正的办公文档格式，可以用相应软件正常打开和编辑。</p>
            
            <h3>Q: 如何调整图片顺序？</h3>
            <p>A: 在图片预览区域，您可以直接拖拽图片来调整顺序。拖拽后序号会自动更新，最终生成的文档将按照您设定的顺序排列图片。</p>
            
            <h3>Q: 图片会上传到服务器吗？</h3>
            <p>A: 不会。所有转换处理都在您的浏览器本地完成，图片不会上传到任何服务器，完全保护您的隐私。</p>
            
            <h3>Q: 生成的文档可以编辑吗？</h3>
            <p>A: 是的。生成的Word(.docx)和Excel(.xlsx)文件是标准的Office文档格式，可以用Microsoft Office、WPS等软件正常打开和编辑。</p>
            
            <h3>Q: 可以批量转换吗？</h3>
            <p>A: 是的，您可以一次选择多张图片进行批量转换，所有图片会按照您设定的顺序统一处理到一个文档中。</p>
            
            <h3>Q: 转换失败怎么办？</h3>
            <p>A: 请检查图片格式是否支持，文件是否损坏，或尝试减少图片数量。如果问题持续，请联系技术支持。</p>
        </div>
    </div>

    <!-- Footer -->
    
    <!-- 页脚将通过JavaScript组件自动生成 -->

    <script>
        let selectedImages = [];
        let selectedFormat = '';
        
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const imagePreview = document.getElementById('imagePreview');
        const previewGrid = document.getElementById('previewGrid');
        const imageCount = document.getElementById('imageCount');
        const convertBtn = document.getElementById('convertBtn');
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const resultContainer = document.getElementById('resultContainer');
        const downloadBtn = document.getElementById('downloadBtn');
        
        // 拖拽上传
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = Array.from(e.dataTransfer.files).filter(file => file.type.startsWith('image/'));
            handleFiles(files);
        });
        
        // 文件选择
        fileInput.addEventListener('change', (e) => {
            const files = Array.from(e.target.files);
            handleFiles(files);
        });
        
        // 处理文件
        function handleFiles(files) {
            files.forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        selectedImages.push({
                            file: file,
                            url: e.target.result,
                            name: file.name
                        });
                        updatePreview();
                    };
                    reader.readAsDataURL(file);
                }
            });
        }
        
        // 更新预览
        function updatePreview() {
            imageCount.textContent = selectedImages.length;
            
            if (selectedImages.length > 0) {
                imagePreview.style.display = 'block';
                previewGrid.innerHTML = '';
                
                selectedImages.forEach((image, index) => {
                    const previewItem = document.createElement('div');
                    previewItem.className = 'preview-item';
                    previewItem.setAttribute('data-index', index);
                    previewItem.innerHTML = `
                        <div class="image-order">${index + 1}</div>
                        <img src="${image.url}" alt="${image.name}" class="preview-img">
                        <button class="remove-btn" onclick="removeImage(${index})">
                            <i class="fas fa-times"></i>
                        </button>
                        <div class="drag-handle">
                            <i class="fas fa-grip-vertical"></i>
                        </div>
                    `;
                    previewGrid.appendChild(previewItem);
                });
                
                // 初始化拖拽排序
                initSortable();
            } else {
                imagePreview.style.display = 'none';
            }
            
            updateConvertButton();
        }
        
        // 初始化拖拽排序
        function initSortable() {
            if (window.sortableInstance) {
                window.sortableInstance.destroy();
            }
            
            window.sortableInstance = Sortable.create(previewGrid, {
                animation: 150,
                ghostClass: 'sortable-ghost',
                dragClass: 'sortable-drag',
                onEnd: function(evt) {
                    const oldIndex = evt.oldIndex;
                    const newIndex = evt.newIndex;
                    
                    // 重新排列数组
                    const movedItem = selectedImages.splice(oldIndex, 1)[0];
                    selectedImages.splice(newIndex, 0, movedItem);
                    
                    // 更新预览（不重新初始化sortable）
                    updatePreviewNumbers();
                }
            });
        }
        
        // 更新预览序号
        function updatePreviewNumbers() {
            const orderElements = previewGrid.querySelectorAll('.image-order');
            orderElements.forEach((element, index) => {
                element.textContent = index + 1;
            });
        }
        
        // 移除图片
        function removeImage(index) {
            selectedImages.splice(index, 1);
            updatePreview();
        }
        
        // 选择转换格式
        function selectFormat(format) {
            // 移除之前的选择
            document.querySelectorAll('.format-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // 添加新选择
            document.querySelector(`[data-format="${format}"]`).classList.add('selected');
            selectedFormat = format;
            
            updateConvertButton();
        }
        
        // 更新转换按钮状态
        function updateConvertButton() {
            convertBtn.disabled = selectedImages.length === 0 || !selectedFormat;
        }
        
        // 开始转换
        async function startConversion() {
            if (selectedImages.length === 0 || !selectedFormat) return;
            
            convertBtn.disabled = true;
            progressContainer.style.display = 'block';
            resultContainer.style.display = 'none';
            
            try {
                progressText.textContent = '正在准备转换...';
                progressFill.style.width = '20%';
                
                let result;
                switch (selectedFormat) {
                    case 'word':
                        result = await convertToWord();
                        break;
                    case 'excel':
                        result = await convertToExcel();
                        break;
                    case 'pdf':
                        result = await convertToPDF();
                        break;
                    case 'long-image':
                        result = await convertToLongImage();
                        break;
                }
                
                progressText.textContent = '转换完成！';
                progressFill.style.width = '100%';
                
                // 显示下载链接
                downloadBtn.href = result.url;
                downloadBtn.download = result.filename;
                
                setTimeout(() => {
                    progressContainer.style.display = 'none';
                    resultContainer.style.display = 'block';
                }, 1000);
                
            } catch (error) {
                console.error('转换失败:', error);
                alert('转换失败，请重试或选择其他格式');
                progressContainer.style.display = 'none';
            }
            
            convertBtn.disabled = false;
        }
        
        // 图片转Word
        async function convertToWord() {
            progressText.textContent = '正在生成Word文档...';
            progressFill.style.width = '30%';
            
            try {
                const { Document, Packer, Paragraph, ImageRun, TextRun, HeadingLevel } = docx;
                
                // 创建文档
                const doc = new Document({
                    sections: [{
                        properties: {},
                        children: [
                            // 标题
                            new Paragraph({
                                children: [
                                    new TextRun({
                                        text: "图片转Word文档",
                                        bold: true,
                                        size: 32,
                                    }),
                                ],
                                heading: HeadingLevel.HEADING_1,
                            }),
                            
                            // 生成信息
                            new Paragraph({
                                children: [
                                    new TextRun({
                                        text: `生成时间: ${new Date().toLocaleString()}`,
                                        size: 24,
                                    }),
                                ],
                            }),
                            
                            new Paragraph({
                                children: [
                                    new TextRun({
                                        text: `图片数量: ${selectedImages.length}`,
                                        size: 24,
                                    }),
                                ],
                            }),
                            
                            new Paragraph({ text: "" }), // 空行
                        ],
                    }],
                });
                
                // 处理每张图片
                for (let i = 0; i < selectedImages.length; i++) {
                    const image = selectedImages[i];
                    
                    progressText.textContent = `正在处理第 ${i + 1}/${selectedImages.length} 张图片...`;
                    progressFill.style.width = (30 + (i / selectedImages.length) * 50) + '%';
                    
                    try {
                        // 将base64转换为ArrayBuffer
                        const base64Data = image.url.split(',')[1];
                        const binaryString = atob(base64Data);
                        const bytes = new Uint8Array(binaryString.length);
                        for (let j = 0; j < binaryString.length; j++) {
                            bytes[j] = binaryString.charCodeAt(j);
                        }
                        
                        // 获取图片尺寸
                        const img = new Image();
                        await new Promise((resolve) => {
                            img.onload = resolve;
                            img.src = image.url;
                        });
                        
                        // 计算适合的尺寸（A4纸宽度约为595点，留边距）
                        const maxWidth = 500;
                        const maxHeight = 400;
                        let width = img.width;
                        let height = img.height;
                        
                        if (width > maxWidth) {
                            height = (height * maxWidth) / width;
                            width = maxWidth;
                        }
                        if (height > maxHeight) {
                            width = (width * maxHeight) / height;
                            height = maxHeight;
                        }
                        
                        // 添加图片标题
                        doc.addSection({
                            children: [
                                new Paragraph({
                                    children: [
                                        new TextRun({
                                            text: `图片 ${i + 1}: ${image.name}`,
                                            bold: true,
                                            size: 28,
                                        }),
                                    ],
                                }),
                                
                                // 添加图片
                                new Paragraph({
                                    children: [
                                        new ImageRun({
                                            data: bytes,
                                            transformation: {
                                                width: width,
                                                height: height,
                                            },
                                        }),
                                    ],
                                }),
                                
                                new Paragraph({ text: "" }), // 空行
                            ],
                        });
                        
                    } catch (imageError) {
                        console.error(`处理图片 ${image.name} 时出错:`, imageError);
                        // 如果图片处理失败，添加文本说明
                        doc.addSection({
                            children: [
                                new Paragraph({
                                    children: [
                                        new TextRun({
                                            text: `图片 ${i + 1}: ${image.name} (处理失败)`,
                                            color: "FF0000",
                                        }),
                                    ],
                                }),
                            ],
                        });
                    }
                }
                
                progressText.textContent = '正在生成Word文件...';
                progressFill.style.width = '90%';
                
                // 生成文档
                const buffer = await Packer.toBuffer(doc);
                const blob = new Blob([buffer], { 
                    type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' 
                });
                const url = URL.createObjectURL(blob);
                
                return {
                    url: url,
                    filename: `images_to_word_${Date.now()}.docx`
                };
                
            } catch (error) {
                console.error('Word文档生成失败:', error);
                throw new Error('Word文档生成失败，请重试');
            }
        }
        
        // 图片转Excel
        async function convertToExcel() {
            progressText.textContent = '正在生成Excel文件...';
            progressFill.style.width = '30%';
            
            try {
                const workbook = new ExcelJS.Workbook();
                const worksheet = workbook.addWorksheet('图片集合');
                
                // 设置列宽
                worksheet.columns = [
                    { header: '序号', key: 'index', width: 10 },
                    { header: '图片名称', key: 'name', width: 30 },
                    { header: '文件大小', key: 'size', width: 15 },
                    { header: '格式', key: 'format', width: 10 },
                    { header: '图片预览', key: 'preview', width: 30 }
                ];
                
                // 设置标题行样式
                const headerRow = worksheet.getRow(1);
                headerRow.font = { bold: true, size: 12 };
                headerRow.fill = {
                    type: 'pattern',
                    pattern: 'solid',
                    fgColor: { argb: 'FF4361EE' }
                };
                headerRow.font = { bold: true, color: { argb: 'FFFFFFFF' } };
                
                // 处理每张图片
                for (let i = 0; i < selectedImages.length; i++) {
                    const image = selectedImages[i];
                    const rowIndex = i + 2; // 从第2行开始（第1行是标题）
                    
                    progressText.textContent = `正在处理第 ${i + 1}/${selectedImages.length} 张图片...`;
                    progressFill.style.width = (30 + (i / selectedImages.length) * 50) + '%';
                    
                    try {
                        // 添加基本信息
                        const size = (image.file.size / 1024).toFixed(2) + ' KB';
                        const format = image.file.type.split('/')[1].toUpperCase();
                        
                        worksheet.addRow({
                            index: i + 1,
                            name: image.name,
                            size: size,
                            format: format,
                            preview: ''
                        });
                        
                        // 设置行高以适应图片
                        const row = worksheet.getRow(rowIndex);
                        row.height = 120;
                        
                        // 将base64转换为buffer
                        const base64Data = image.url.split(',')[1];
                        const binaryString = atob(base64Data);
                        const bytes = new Uint8Array(binaryString.length);
                        for (let j = 0; j < binaryString.length; j++) {
                            bytes[j] = binaryString.charCodeAt(j);
                        }
                        
                        // 添加图片到工作表
                        const imageId = workbook.addImage({
                            buffer: bytes,
                            extension: format.toLowerCase() === 'jpg' ? 'jpeg' : format.toLowerCase(),
                        });
                        
                        // 获取图片尺寸并计算适合的大小
                        const img = new Image();
                        await new Promise((resolve) => {
                            img.onload = resolve;
                            img.src = image.url;
                        });
                        
                        const maxWidth = 200;
                        const maxHeight = 100;
                        let width = img.width;
                        let height = img.height;
                        
                        if (width > maxWidth) {
                            height = (height * maxWidth) / width;
                            width = maxWidth;
                        }
                        if (height > maxHeight) {
                            width = (width * maxHeight) / height;
                            height = maxHeight;
                        }
                        
                        // 将图片添加到单元格
                        worksheet.addImage(imageId, {
                            tl: { col: 4.1, row: rowIndex - 0.9 }, // 图片预览列
                            ext: { width: width, height: height }
                        });
                        
                    } catch (imageError) {
                        console.error(`处理图片 ${image.name} 时出错:`, imageError);
                        // 如果图片处理失败，只添加基本信息
                        const size = (image.file.size / 1024).toFixed(2) + ' KB';
                        const format = image.file.type.split('/')[1].toUpperCase();
                        
                        worksheet.addRow({
                            index: i + 1,
                            name: image.name + ' (处理失败)',
                            size: size,
                            format: format,
                            preview: '图片处理失败'
                        });
                    }
                }
                
                // 添加汇总信息
                const summaryRowIndex = selectedImages.length + 3;
                worksheet.addRow({});
                worksheet.addRow({
                    index: '',
                    name: '生成时间:',
                    size: new Date().toLocaleString(),
                    format: '',
                    preview: ''
                });
                worksheet.addRow({
                    index: '',
                    name: '总图片数:',
                    size: selectedImages.length,
                    format: '',
                    preview: ''
                });
                
                progressText.textContent = '正在生成Excel文件...';
                progressFill.style.width = '90%';
                
                // 生成文件
                const buffer = await workbook.xlsx.writeBuffer();
                const blob = new Blob([buffer], { 
                    type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' 
                });
                const url = URL.createObjectURL(blob);
                
                return {
                    url: url,
                    filename: `images_to_excel_${Date.now()}.xlsx`
                };
                
            } catch (error) {
                console.error('Excel文件生成失败:', error);
                throw new Error('Excel文件生成失败，请重试');
            }
        }
        
        // 图片转PDF
        async function convertToPDF() {
            progressText.textContent = '正在生成PDF文档...';
            progressFill.style.width = '40%';
            
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();
            
            for (let i = 0; i < selectedImages.length; i++) {
                const image = selectedImages[i];
                
                progressText.textContent = `正在处理第 ${i + 1}/${selectedImages.length} 张图片...`;
                progressFill.style.width = (40 + (i / selectedImages.length) * 40) + '%';
                
                if (i > 0) {
                    pdf.addPage();
                }
                
                // 获取图片尺寸并调整到页面大小
                const img = new Image();
                await new Promise((resolve) => {
                    img.onload = resolve;
                    img.src = image.url;
                });
                
                const pageWidth = pdf.internal.pageSize.getWidth();
                const pageHeight = pdf.internal.pageSize.getHeight();
                const imgRatio = img.width / img.height;
                const pageRatio = pageWidth / pageHeight;
                
                let imgWidth, imgHeight;
                if (imgRatio > pageRatio) {
                    imgWidth = pageWidth - 20;
                    imgHeight = imgWidth / imgRatio;
                } else {
                    imgHeight = pageHeight - 20;
                    imgWidth = imgHeight * imgRatio;
                }
                
                const x = (pageWidth - imgWidth) / 2;
                const y = (pageHeight - imgHeight) / 2;
                
                pdf.addImage(image.url, 'JPEG', x, y, imgWidth, imgHeight);
            }
            
            progressText.textContent = '正在生成PDF文件...';
            progressFill.style.width = '90%';
            
            const pdfBlob = pdf.output('blob');
            const url = URL.createObjectURL(pdfBlob);
            
            return {
                url: url,
                filename: `images_to_pdf_${Date.now()}.pdf`
            };
        }
        
        // 合并长图
        async function convertToLongImage() {
            progressText.textContent = '正在加载图片...';
            progressFill.style.width = '30%';
            
            const images = [];
            let maxWidth = 0;
            let totalHeight = 0;
            
            // 加载所有图片
            for (let i = 0; i < selectedImages.length; i++) {
                const img = new Image();
                await new Promise((resolve) => {
                    img.onload = () => {
                        images.push(img);
                        maxWidth = Math.max(maxWidth, img.width);
                        totalHeight += img.height;
                        resolve();
                    };
                    img.src = selectedImages[i].url;
                });
                
                progressText.textContent = `正在加载第 ${i + 1}/${selectedImages.length} 张图片...`;
                progressFill.style.width = (30 + (i / selectedImages.length) * 40) + '%';
            }
            
            progressText.textContent = '正在合并图片...';
            progressFill.style.width = '80%';
            
            // 创建画布
            const canvas = document.createElement('canvas');
            canvas.width = maxWidth;
            canvas.height = totalHeight;
            const ctx = canvas.getContext('2d');
            
            // 设置白色背景
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 绘制所有图片
            let currentY = 0;
            images.forEach((img) => {
                const x = (maxWidth - img.width) / 2; // 居中对齐
                ctx.drawImage(img, x, currentY);
                currentY += img.height;
            });
            
            progressText.textContent = '正在生成最终图片...';
            progressFill.style.width = '95%';
            
            return new Promise((resolve) => {
                canvas.toBlob((blob) => {
                    const url = URL.createObjectURL(blob);
                    resolve({
                        url: url,
                        filename: `merged_long_image_${Date.now()}.png`
                    });
                }, 'image/png', 0.95);
            });
        }
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化导航栏和页脚组件
            const navbar = new NavbarComponent();
            const navbarStyles = document.createElement('style');
            navbarStyles.textContent = NavbarComponent.getStyles();
            document.head.appendChild(navbarStyles);

            const footer = new FooterComponent();
            const footerStyles = document.createElement('style');
            footerStyles.textContent = FooterComponent.getStyles();
            document.head.appendChild(footerStyles);
});
    </script>
</body>
</html>