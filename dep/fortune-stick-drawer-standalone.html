<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>在线抽签工具 - 求签问卜，指点迷津</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="专业的在线抽签工具，提供综合运势、事业运势、姻缘运势、学业运势等多种签文。传统文化与现代科技结合，为您指点迷津，解答人生疑惑。">
    <meta name="keywords" content="在线抽签,求签问卜,运势测算,签文解读,传统文化,占卜工具,命理预测">
    <meta name="author" content="小鹿工具">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="在线抽签工具 - 求签问卜，指点迷津">
    <meta property="og:description" content="专业的在线抽签工具，提供多种运势签文，传统文化与现代科技结合，为您指点迷津。">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://tools.example.com/fortune-stick-drawer">
    <meta property="og:image" content="https://tools.example.com/images/fortune-stick-drawer-og.jpg">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="在线抽签工具 - 求签问卜，指点迷津">
    <meta name="twitter:description" content="专业的在线抽签工具，提供多种运势签文，传统文化与现代科技结合。">
    <meta name="twitter:image" content="https://tools.example.com/images/fortune-stick-drawer-twitter.jpg">
    
    <!-- Schema.org Markup -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "在线抽签工具",
        "description": "专业的在线抽签工具，提供综合运势、事业运势、姻缘运势、学业运势等多种签文",
        "url": "https://tools.example.com/fortune-stick-drawer",
        "applicationCategory": "LifestyleApplication",
        "operatingSystem": "Any",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "CNY"
        }
    }
    </script>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        .container {
            padding-top: 2rem;
            padding-bottom: 2rem;
        }
        
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            background: rgba(255,255,255,0.95);
        }
        
        .card-header {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            text-align: center;
            padding: 1.5rem;
        }
        
        .fortune-stick {
            background: linear-gradient(45deg, #8B4513, #D2691E);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(139,69,19,0.3);
        }
        
        .fortune-stick:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(139,69,19,0.4);
            background: linear-gradient(45deg, #A0522D, #F4A460);
        }
        
        .fortune-result {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px;
            padding: 2rem;
            margin: 1rem 0;
            text-align: center;
        }
        
        .fortune-number {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }
        
        .fortune-level {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            padding: 0.5rem 1rem;
            background: rgba(255,255,255,0.2);
            border-radius: 25px;
            display: inline-block;
        }
        
        .fortune-content {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            font-style: italic;
            line-height: 1.6;
        }
        
        .fortune-explanation {
            font-size: 1rem;
            opacity: 0.9;
            line-height: 1.5;
        }
        
        .btn-group .btn {
            border-radius: 25px;
            margin: 0 5px;
            padding: 10px 20px;
        }
        
        .lunar-date {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 0.5rem 1rem;
            margin-bottom: 1rem;
            text-align: center;
            color: #666;
        }
        
        .nav-tabs .nav-link {
            border-radius: 10px 10px 0 0;
            border: none;
            background: rgba(255,255,255,0.1);
            color: #666;
            margin-right: 5px;
        }
        
        .nav-tabs .nav-link.active {
            background: white;
            color: #333;
        }
        
        .tab-content {
            background: white;
            border-radius: 0 10px 10px 10px;
            padding: 1rem;
        }
        
        .list-group-item {
            border: none;
            border-bottom: 1px solid #eee;
            border-radius: 0;
        }
        
        .list-group-item:last-child {
            border-bottom: none;
        }
        
        .badge {
            font-size: 0.8rem;
        }
        
        .btn-outline-danger {
            border-radius: 20px;
        }
        
        #favoriteButton.active {
            background: #dc3545;
            color: white;
        }
        
        .fortune-types {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        
        .fortune-type {
            background: rgba(255,255,255,0.9);
            border: 2px solid transparent;
            border-radius: 25px;
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #333;
        }
        
        .fortune-type:hover {
            background: white;
            border-color: #667eea;
            transform: translateY(-2px);
        }
        
        .fortune-type.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header">
                        <h1 class="mb-0"><i class="fas fa-yin-yang me-2"></i>在线抽签工具</h1>
                        <p class="mb-0 mt-2">求签问卜，指点迷津</p>
                    </div>
                    <div class="card-body">
                        <!-- 农历日期显示 -->
                        <div class="lunar-date">
                            <i class="fas fa-calendar-alt me-2"></i>
                            <span id="lunarDate">加载中...</span>
                        </div>
                        
                        <!-- 运势类型选择 -->
                        <div class="fortune-types">
                            <div class="fortune-type active" data-type="general">
                                <i class="fas fa-star me-1"></i>综合运势
                            </div>
                            <div class="fortune-type" data-type="career">
                                <i class="fas fa-briefcase me-1"></i>事业运势
                            </div>
                            <div class="fortune-type" data-type="love">
                                <i class="fas fa-heart me-1"></i>姻缘运势
                            </div>
                            <div class="fortune-type" data-type="study">
                                <i class="fas fa-graduation-cap me-1"></i>学业运势
                            </div>
                        </div>
                        
                        <!-- 抽签按钮 -->
                        <div class="text-center mb-4">
                            <button class="btn fortune-stick" onclick="drawFortune()">
                                <i class="fas fa-hand-paper me-2"></i>虔诚抽签
                            </button>
                        </div>
                        
                        <!-- 抽签结果 -->
                        <div id="fortuneResult" class="fortune-result" style="display: none;">
                            <div class="fortune-number" id="stickNumber">第1签</div>
                            <div class="fortune-level" id="fortuneLevel">上上签</div>
                            <div class="fortune-content" id="fortuneContent">签文内容</div>
                            <div class="fortune-explanation" id="fortuneExplanation">签文解释</div>
                            
                            <!-- 操作按钮 -->
                            <div class="btn-group mt-3" role="group">
                                <button type="button" class="btn btn-outline-light" onclick="shareFortuneResult()">
                                    <i class="fas fa-share-alt me-1"></i>分享
                                </button>
                                <button type="button" class="btn btn-outline-light" id="favoriteButton" onclick="toggleFavorite()">
                                    <i class="fas fa-heart me-1"></i>收藏
                                </button>
                                <button type="button" class="btn btn-outline-light" onclick="drawFortune()">
                                    <i class="fas fa-redo me-1"></i>再抽一签
                                </button>
                            </div>
                        </div>
                        
                        <!-- 历史记录和收藏 -->
                        <div class="mt-4">
                            <ul class="nav nav-tabs" id="recordTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="history-tab" data-bs-toggle="tab" data-bs-target="#history" type="button" role="tab">
                                        <i class="fas fa-history me-1"></i>历史记录
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="favorites-tab" data-bs-toggle="tab" data-bs-target="#favorites" type="button" role="tab">
                                        <i class="fas fa-heart me-1"></i>我的收藏
                                    </button>
                                </li>
                            </ul>
                            <div class="tab-content" id="recordTabContent">
                                <div class="tab-pane fade show active" id="history" role="tabpanel">
                                    <div class="list-group" id="historyList">
                                        <div class="list-group-item text-center text-muted">暂无历史记录</div>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="favorites" role="tabpanel">
                                    <div class="list-group" id="favoritesList">
                                        <div class="list-group-item text-center text-muted">暂无收藏</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 工具特点 -->
                <div class="row mt-4">
                    <div class="col-md-4 mb-3">
                        <div class="card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-yin-yang fa-3x text-primary mb-3"></i>
                                <h5>传统文化</h5>
                                <p class="text-muted">融合传统抽签文化，提供正宗的签文体验</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-mobile-alt fa-3x text-success mb-3"></i>
                                <h5>随时随地</h5>
                                <p class="text-muted">支持手机、平板、电脑，随时随地求签问卜</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card h-100">
                            <div class="card-body text-center">
                                <i class="fas fa-chart-line fa-3x text-warning mb-3"></i>
                                <h5>多种运势</h5>
                                <p class="text-muted">提供综合、事业、姻缘、学业等多种运势签文</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 应用场景 -->
                <div class="card mt-4">
                    <div class="card-header">
                        <h3 class="mb-0"><i class="fas fa-lightbulb me-2"></i>应用场景</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <ul class="list-unstyled">
                                    <li><i class="fas fa-check text-success me-2"></i>人生重大决策前的参考</li>
                                    <li><i class="fas fa-check text-success me-2"></i>工作事业发展方向指导</li>
                                    <li><i class="fas fa-check text-success me-2"></i>感情婚姻问题咨询</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <ul class="list-unstyled">
                                    <li><i class="fas fa-check text-success me-2"></i>学习考试运势预测</li>
                                    <li><i class="fas fa-check text-success me-2"></i>日常生活疑惑解答</li>
                                    <li><i class="fas fa-check text-success me-2"></i>心理压力释放和安慰</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 常见问题 -->
                <div class="card mt-4">
                    <div class="card-header">
                        <h3 class="mb-0"><i class="fas fa-question-circle me-2"></i>常见问题</h3>
                    </div>
                    <div class="card-body">
                        <div class="accordion" id="faqAccordion">
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                                        抽签结果准确吗？
                                    </button>
                                </h2>
                                <div id="faq1" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        抽签是一种传统文化形式，主要用于心理暗示和精神寄托。结果仅供参考，不应作为重大决策的唯一依据。
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                                        可以连续抽签吗？
                                    </button>
                                </h2>
                                <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        可以连续抽签，但建议带着虔诚的心态，针对不同的问题进行抽签，这样更有意义。
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                                        如何理解签文含义？
                                    </button>
                                </h2>
                                <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                                    <div class="accordion-body">
                                        每个签文都配有详细的解释说明，您可以结合自己的实际情况来理解和参考。
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // 签文数据
        const FortuneData = {
            // 综合运势
            general: [
                { number: 1, level: '上上签', content: '春风得意马蹄疾，一日看尽长安花。', explanation: '大吉大利，诸事顺遂，近期将有好运降临。' },
                { number: 2, level: '上签', content: '云开月明春色好，喜从天降福临门。', explanation: '运势良好，可以大胆向前，把握机遇。' },
                { number: 3, level: '上签', content: '明月照高楼，流光正徘徊。', explanation: '运势渐入佳境，静待好事发生。' },
                { number: 4, level: '中签', content: '山重水复疑无路，柳暗花明又一村。', explanation: '当前困境即将过去，柳暗花明就在眼前。' },
                { number: 5, level: '中签', content: '风雨过后见彩虹，守得云开见月明。', explanation: '暂时的困难将会过去，保持耐心和信心。' },
                { number: 6, level: '下签', content: '浮云遮月暂时明，静待天晴见月光。', explanation: '当前运势有所阻滞，需要耐心等待时机。' }
            ],
            
            // 事业运势
            career: [
                { number: 1, level: '上上签', content: '鲲鹏展翅九万里，一飞冲天志气高。', explanation: '事业发展顺利，将有重大突破，适合大展宏图。' },
                { number: 2, level: '上签', content: '春种一粒粟，秋收万颗子。', explanation: '付出必有回报，坚持当下的努力终将开花结果。' },
                { number: 3, level: '上签', content: '长风破浪会有时，直挂云帆济沧海。', explanation: '事业正处上升期，大胆追求理想。' },
                { number: 4, level: '中签', content: '不经一番寒彻骨，怎得梅花扑鼻香。', explanation: '成功需要经历磨练，坚持努力终会有回报。' },
                { number: 5, level: '中签', content: '路漫漫其修远兮，吾将上下而求索。', explanation: '前路虽远，但持续探索必有收获。' },
                { number: 6, level: '下签', content: '天时未至休强求，且待春来百花开。', explanation: '时机未到，应当沉淀自我，等待机会。' }
            ],
            
            // 姻缘运势
            love: [
                { number: 1, level: '上上签', content: '有情人终成眷属，千里姻缘一线牵。', explanation: '桃花运旺盛，有望收获真挚感情，已有伴侣者感情更加稳定。' },
                { number: 2, level: '上签', content: '良缘天定，静待佳音。', explanation: '感情发展平稳，保持耐心和真诚，缘分自会降临。' },
                { number: 3, level: '上签', content: '月老牵红线，佳偶天注定。', explanation: '姻缘有好的征兆，保持开放的心态。' },
                { number: 4, level: '中签', content: '相逢恨晚日，携手共白头。', explanation: '可能遇到意中人，要把握机会增进了解。' },
                { number: 5, level: '中签', content: '缘分总是猝不及防，静待花开结果时。', explanation: '感情需要时间培养，不要着急。' },
                { number: 6, level: '下签', content: '姻缘暂未到，且待月圆时。', explanation: '当前感情运势平平，建议先专注自我提升。' }
            ],
            
            // 学业运势
            study: [
                { number: 1, level: '上上签', content: '十年寒窗无人问，一举成名天下知。', explanation: '学业有成在望，付出的努力将得到回报，建议继续保持专注。' },
                { number: 2, level: '上签', content: '书山有路勤为径，学海无涯苦作舟。', explanation: '学习进展顺利，通过勤奋可以取得好成绩。' },
                { number: 3, level: '上签', content: '凤凰台上凤凰游，学有所成天下走。', explanation: '学习方向正确，继续努力必有所获。' },
                { number: 4, level: '中签', content: '莫等闲，白了少年头，空悲切。', explanation: '要珍惜学习时光，适当调整学习方法。' },
                { number: 5, level: '中签', content: '纸上得来终觉浅，绝知此事要躬行。', explanation: '理论结合实践，学习效果会更好。' },
                { number: 6, level: '下签', content: '学海浩渺无涯际，一步一个脚印行。', explanation: '学习过程可能遇到困难，需要调整心态和方法。' }
            ]
        };
        
        // 当前选择的运势类型
        let currentFortuneType = 'general';
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            showLunarDate();
            showHistory();
            showFavorites();
            
            // 运势类型选择事件
            document.querySelectorAll('.fortune-type').forEach(type => {
                type.addEventListener('click', function() {
                    document.querySelectorAll('.fortune-type').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    currentFortuneType = this.dataset.type;
                });
            });
        });
        
        // 抽签主函数
        function drawFortune() {
            // 检查每日抽签次数限制（可选功能）
            if (!checkDailyLimit(10)) {
                alert('今日抽签次数已达上限，请明日再来！');
                return;
            }
            
            // 获取随机签文
            const fortune = getRandomFortune(currentFortuneType);
            
            // 显示抽签结果
            showFortuneResult(fortune);
            
            // 保存到历史记录
            saveFortuneHistory(fortune, currentFortuneType);
            
            // 显示结果区域
            document.getElementById('fortuneResult').style.display = 'block';
            
            // 滚动到结果区域
            document.getElementById('fortuneResult').scrollIntoView({ behavior: 'smooth' });
            
            // 检查是否已收藏
            checkIfFavorited(fortune);
        }
        
        // 检查签文是否已收藏
        function checkIfFavorited(fortune) {
            const favorites = JSON.parse(localStorage.getItem('fortuneFavorites') || '[]');
            const isFavorited = favorites.some(f => f.content === fortune.content);
            const favoriteButton = document.getElementById('favoriteButton');
            
            if (isFavorited) {
                favoriteButton.classList.add('active');
            } else {
                favoriteButton.classList.remove('active');
            }
        }
        
        // 初始化应用
        function initializeApp() {
            // 初始化本地存储
            if (!localStorage.getItem('fortuneHistory')) {
                localStorage.setItem('fortuneHistory', '[]');
            }
            if (!localStorage.getItem('fortuneFavorites')) {
                localStorage.setItem('fortuneFavorites', '[]');
            }
        }
        
        // 显示农历日期
        function showLunarDate() {
            const date = new Date();
            const lunarDate = solarToLunar(date);
            document.getElementById('lunarDate').textContent = 
                `农历${lunarDate.monthStr}月${lunarDate.dayStr}`;
        }
        
        // 农历日期转换函数
        function solarToLunar(date) {
            const lunarInfo = [0x04bd8,0x04ae0,0x0a570,0x054d5,0x0d260,0x0d950,0x16554,0x056a0,0x09ad0,0x055d2,
                0x04ae0,0x0a5b6,0x0a4d0,0x0d250,0x1d255,0x0b540,0x0d6a0,0x0ada2,0x095b0,0x14977,
                0x04970,0x0a4b0,0x0b4b5,0x06a50,0x06d40,0x1ab54,0x02b60,0x09570,0x052f2,0x04970,
                0x06566,0x0d4a0,0x0ea50,0x06e95,0x05ad0,0x02b60,0x186e3,0x092e0,0x1c8d7,0x0c950,
                0x0d4a0,0x1d8a6,0x0b550,0x056a0,0x1a5b4,0x025d0,0x092d0,0x0d2b2,0x0a950,0x0b557];
            
            const animals = ['鼠','牛','虎','兔','龙','蛇','马','羊','猴','鸡','狗','猪'];
            const months = ['正','二','三','四','五','六','七','八','九','十','冬','腊'];
            const days = ['初一','初二','初三','初四','初五','初六','初七','初八','初九','初十',
                       '十一','十二','十三','十四','十五','十六','十七','十八','十九','二十',
                       '廿一','廿二','廿三','廿四','廿五','廿六','廿七','廿八','廿九','三十'];
            
            const year = date.getFullYear();
            let month = date.getMonth() + 1;
            let day = date.getDate();
            
            // 计算距离1900年1月31日的天数
            let offset = (Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()) - Date.UTC(1900, 0, 31)) / 86400000;
            
            let temp = 0, i;
            for(i = 1900; i < 2050 && offset > 0; i++) {
                temp = getLunarYearDays(i);
                offset -= temp;
            }
            if(offset < 0) {
                offset += temp;
                i--;
            }
            
            // 计算农历月份和日期
            let isLeap = false, leap = 0;
            let lunarMonth = 1, lunarDay = 1;
            let temp2 = getLunarYearInfo(i - 1900);
            let monthDays = [];
            
            for(let j = 0; j < 12; j++) {
                monthDays[j] = (temp2 & (0x10000 >> j)) ? 30 : 29;
            }
            
            for(let j = 0; j < 12; j++) {
                if(offset < monthDays[j]) {
                    lunarMonth = j + 1;
                    lunarDay = offset + 1;
                    break;
                }
                offset -= monthDays[j];
            }
            
            function getLunarYearInfo(year) {
                return lunarInfo[year];
            }
            
            function getLunarYearDays(year) {
                let sum = 348;
                let info = getLunarYearInfo(year - 1900);
                for(let i = 0x8000; i > 0x8; i >>= 1) {
                    sum += (info & i) ? 1 : 0;
                }
                return sum + getLeapMonthDays(year);
            }
            
            function getLeapMonthDays(year) {
                if(getLeapMonth(year)) {
                    return (getLunarYearInfo(year - 1900) & 0x10000) ? 30 : 29;
                }
                return 0;
            }
            
            function getLeapMonth(year) {
                return getLunarYearInfo(year - 1900) & 0xf;
            }
            
            return {
                year: i,
                month: lunarMonth,
                day: lunarDay,
                monthStr: months[lunarMonth - 1],
                dayStr: days[lunarDay - 1],
                animal: animals[(i - 4) % 12]
            };
        }
        
        // 检查每日抽签次数限制
        function checkDailyLimit(limit) {
            const today = new Date().toLocaleDateString();
            const history = JSON.parse(localStorage.getItem('fortuneHistory') || '[]');
            const todayCount = history.filter(h => 
                new Date(h.timestamp).toLocaleDateString() === today
            ).length;
            return todayCount < limit;
        }
        
        // 获取随机签文
        function getRandomFortune(type) {
            const fortunes = FortuneData[type];
            return fortunes[Math.floor(Math.random() * fortunes.length)];
        }
        
        // 显示抽签结果
        function showFortuneResult(fortune) {
            document.getElementById('stickNumber').textContent = fortune.number;
            document.getElementById('fortuneLevel').textContent = fortune.level;
            document.getElementById('fortuneContent').textContent = fortune.content;
            document.getElementById('fortuneExplanation').textContent = fortune.explanation;
        }
        
        // 保存抽签历史
        function saveFortuneHistory(fortune, type) {
            const history = JSON.parse(localStorage.getItem('fortuneHistory') || '[]');
            const newFortune = {
                ...fortune,
                type,
                timestamp: new Date().toISOString()
            };
            history.push(newFortune);
            // 只保留最近30条记录
            if (history.length > 30) {
                history.shift();
            }
            localStorage.setItem('fortuneHistory', JSON.stringify(history));
            // 更新历史记录显示
            showHistory();
        }
        
        // 分享抽签结果
        function shareFortuneResult() {
            const fortune = {
                number: document.getElementById('stickNumber').textContent,
                level: document.getElementById('fortuneLevel').textContent,
                content: document.getElementById('fortuneContent').textContent,
                explanation: document.getElementById('fortuneExplanation').textContent
            };
            
            const shareText = `
                在线抽签结果分享：
                第${fortune.number}签 【${fortune.level}】
                签文：${fortune.content}
                解释：${fortune.explanation}
            `.trim();
            
            if (navigator.share) {
                navigator.share({
                    title: '在线抽签结果',
                    text: shareText,
                    url: window.location.href
                }).catch(console.error);
            } else {
                // 复制到剪贴板
                const textarea = document.createElement('textarea');
                textarea.value = shareText;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('抽签结果已复制到剪贴板！');
            }
        }
        
        // 切换收藏状态
        function toggleFavorite() {
            const fortune = {
                number: document.getElementById('stickNumber').textContent,
                level: document.getElementById('fortuneLevel').textContent,
                content: document.getElementById('fortuneContent').textContent,
                explanation: document.getElementById('fortuneExplanation').textContent,
                timestamp: new Date().toISOString()
            };
            
            const favorites = JSON.parse(localStorage.getItem('fortuneFavorites') || '[]');
            const index = favorites.findIndex(f => f.content === fortune.content);
            
            if (index === -1) {
                favorites.push(fortune);
                document.getElementById('favoriteButton').classList.add('active');
                alert('已添加到收藏！');
            } else {
                favorites.splice(index, 1);
                document.getElementById('favoriteButton').classList.remove('active');
                alert('已取消收藏！');
            }
            
            localStorage.setItem('fortuneFavorites', JSON.stringify(favorites));
            // 更新收藏列表显示
            showFavorites();
        }
        
        // 显示历史记录
        function showHistory() {
            const history = JSON.parse(localStorage.getItem('fortuneHistory') || '[]');
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';
            
            history.reverse().forEach(fortune => {
                const date = new Date(fortune.timestamp);
                const item = document.createElement('div');
                item.className = 'list-group-item';
                item.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="mb-1">${fortune.level} - ${fortune.content}</h6>
                            <small class="text-muted">${date.toLocaleString()}</small>
                        </div>
                        <span class="badge bg-primary rounded-pill">${getTypeText(fortune.type)}</span>
                    </div>
                `;
                historyList.appendChild(item);
            });
            
            if (history.length === 0) {
                historyList.innerHTML = '<div class="list-group-item text-center text-muted">暂无历史记录</div>';
            }
        }
        
        // 显示收藏列表
        function showFavorites() {
            const favorites = JSON.parse(localStorage.getItem('fortuneFavorites') || '[]');
            const favoritesList = document.getElementById('favoritesList');
            favoritesList.innerHTML = '';
            
            favorites.reverse().forEach(fortune => {
                const date = new Date(fortune.timestamp);
                const item = document.createElement('div');
                item.className = 'list-group-item';
                item.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="mb-1">${fortune.level} - ${fortune.content}</h6>
                            <small class="text-muted">${date.toLocaleString()}</small>
                        </div>
                        <button class="btn btn-outline-danger btn-sm" onclick="removeFavorite('${fortune.content}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                favoritesList.appendChild(item);
            });
            
            if (favorites.length === 0) {
                favoritesList.innerHTML = '<div class="list-group-item text-center text-muted">暂无收藏</div>';
            }
        }
        
        // 获取运势类型文本
        function getTypeText(type) {
            const typeMap = {
                general: '综合运势',
                career: '事业运势',
                love: '姻缘运势',
                study: '学业运势'
            };
            return typeMap[type] || type;
        }
        
        // 删除收藏
        window.removeFavorite = function(content) {
            const favorites = JSON.parse(localStorage.getItem('fortuneFavorites') || '[]');
            const index = favorites.findIndex(f => f.content === content);
            if (index !== -1) {
                favorites.splice(index, 1);
                localStorage.setItem('fortuneFavorites', JSON.stringify(favorites));
                showFavorites();
            }
        };
    </script>
</body>
</html>